<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/bootstrap.css">
  <link rel="stylesheet" href="css/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>

  <style>
    body {
      font-size: medium;
      display: flex;
    }
    #sidebar {
      width: 220px;
      height: 100vh;
      background-color: #f8f9fa;
      padding: 20px;
      border-right: 1px solid #ddd;
    }
    #main {
      flex: 1;
      padding: 20px;
    }
    .sidebar-link {
      display: block;
      margin-bottom: 10px;
      font-weight: bold;
      color: #000;
      text-decoration: none;
    }
    .sidebar-link:hover {
      text-decoration: underline;
    }
    #floatingForm {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 500px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      z-index: 1050;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      display: none;
    }
    #floatingFormBackdrop {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1040;
      display: none;
    }
  </style>
</head>
<body>
  <div id="sidebar">
    <h4>Admin Panel</h4>
    <a class="sidebar-link" href="index.html">Preview Blogs</a>
    <a class="sidebar-link" href="#" onclick="showCreateModal()">Generate New Blog</a>
    <a class="sidebar-link" href="#" onclick="loadProfile()">Profile</a>
    <a class="sidebar-link text-danger" href="#" onclick="logout()">Logout</a>
  </div>

  <div id="main">
    <h1 class="mb-4">Admin Dashboard</h1>
    <div id="output"></div>
  </div>

  <!-- Floating Form Window -->
  <div id="floatingFormBackdrop" onclick="closeFloatingForm()"></div>
  <div id="floatingForm">
    <h5 id="floatingFormTitle">New Blog</h5>
    <form onsubmit="submitBlog(event)">
      <input type="hidden" id="blog-id">
      <div class="mb-3">
        <label class="form-label">Title</label>
        <input type="text" class="form-control" id="blog-title" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Content</label>
        <textarea class="form-control" id="blog-content" rows="4" required></textarea>
      </div>
      <div class="mb-3">
        <label class="form-label">Category</label>
        <input type="text" class="form-control" id="blog-category">
      </div>
      <div class="text-end">
        <button type="button" class="btn btn-secondary" onclick="closeFloatingForm()">Cancel</button>
        <button type="submit" class="btn btn-primary">Save Blog</button>
      </div>
    </form>
  </div>

  <script>
    const API_ROOT = 'http://127.0.0.1:8000/api';
    const accessToken = localStorage.getItem('access_token');
    const adminUUID = localStorage.getItem('admin_uuid');

    if (!accessToken || !adminUUID) {
      alert("You're not logged in.");
      window.location.href = 'login.html';
    } else {
      loadBlogs();
    }

    function getAuthHeaders() {
      return {
        'Authorization': `Bearer ${accessToken}`,
        'Content-Type': 'application/json'
      };
    }

    async function authFetch(url, options = {}) {
      const res = await fetch(`${API_ROOT}${url}`, {
        ...options,
        headers: getAuthHeaders()
      });

      if (res.status === 401) {
        alert("Session expired. Please log in again.");
        window.location.href = 'login.html';
        return;
      }
      return res.json();
    }

    async function loadBlogs() {
      const blogs = await authFetch(`/${adminUUID}/admin/blogs/`);
      const out = document.getElementById('output');
      out.innerHTML = `<h3>My Blogs</h3>
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>ID</th>
              <th>Title</th>
              <th>Content (preview)</th>
              <th>Published</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${blogs.map(blog => `
              <tr>
                <td>${blog.id}</td>
                <td>${blog.title}</td>
                <td>${(blog.content || '').substring(0, 100)}...</td>
                <td><button class="btn btn-sm btn-${blog.published ? 'success' : 'secondary'}">
                  ${blog.published ? 'Published' : 'Unpublished'}
                </button></td>
                <td>
                  <div class="dropdown">
                    <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton${blog.id}" data-bs-toggle="dropdown" aria-expanded="false">
                      &#8942;
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton${blog.id}">
                      <li><a class="dropdown-item" href="#" onclick='editBlog(${JSON.stringify(blog)})'>Edit</a></li>
                      <li><a class="dropdown-item" href="#" onclick='deleteBlog(${blog.id})'>Delete</a></li>
                      <li><a class="dropdown-item" href="#">Regenerate</a></li>
                    </ul>
                  </div>
                </td>
              </tr>`).join('')}
          </tbody>
        </table>`;
    }

    function showCreateModal() {
      document.getElementById('floatingFormTitle').innerText = 'Create Blog';
      document.getElementById('blog-id').value = '';
      document.getElementById('blog-title').value = '';
      document.getElementById('blog-content').value = '';
      document.getElementById('blog-category').value = '';
      openFloatingForm();
    }

    function editBlog(blog) {
      document.getElementById('floatingFormTitle').innerText = 'Edit Blog';
      document.getElementById('blog-id').value = blog.id;
      document.getElementById('blog-title').value = blog.title;
      document.getElementById('blog-content').value = blog.content;
      document.getElementById('blog-category').value = blog.category;
      openFloatingForm();
    }

    function openFloatingForm() {
      document.getElementById('floatingForm').style.display = 'block';
      document.getElementById('floatingFormBackdrop').style.display = 'block';
    }

    function closeFloatingForm() {
      document.getElementById('floatingForm').style.display = 'none';
      document.getElementById('floatingFormBackdrop').style.display = 'none';
    }

    async function submitBlog(e) {
      e.preventDefault();
      const id = document.getElementById('blog-id').value;
      const title = document.getElementById('blog-title').value;
      const content = document.getElementById('blog-content').value;
      const category = document.getElementById('blog-category').value;

      const blog = { title, content, category };
      const method = id ? 'PUT' : 'POST';
      const url = id
        ? `/${adminUUID}/admin/blogs/${id}/`
        : `/${adminUUID}/admin/blogs/`;

      await authFetch(url, {
        method,
        body: JSON.stringify(blog)
      });

      closeFloatingForm();
      loadBlogs();
    }

    async function deleteBlog(id) {
      if (!confirm('Are you sure?')) return;
      await authFetch(`/${adminUUID}/admin/blogs/${id}/`, {
        method: 'DELETE'
      });
      loadBlogs();
    }

    async function loadProfile() {
      const profile = await authFetch(`/${adminUUID}/admin/profil/`);
      const out = document.getElementById('output');
      out.innerHTML = `
        <h3>Admin Profile</h3>
        <p><strong>Username:</strong> ${profile.username}</p>
        <p><strong>Email:</strong> ${profile.email}</p>`;
    }

    function logout() {
      localStorage.clear();
      window.location.href = 'login.html';
    }
  </script>

  <script src="js/bootstrap.min.js"></script>
  <script src="js/jquery.min.js"></script>
</body>
</html>


<!-- 
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/bootstrap.css">
  <link rel="stylesheet" href="css/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
</head>
<body>
  <ul class="nav justify-content-center bg-light py-3 mb-4">
    <li class="nav-item">
      <a class="nav-link active" aria-current="page" href="#" onclick="loadBlogs()">Preview Blogs</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" onclick="showCreateForm()">Generate New Blog</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" onclick="loadProfile()">Profile</a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-danger" href="#" onclick="logout()">Logout</a>
    </li>
  </ul>

  <div class="container">
    <h1 class="mb-4">Admin Dashboard</h1>

    <div id="output"></div>

    <div id="form-area" style="display:none;">
      <h3 id="form-title">Create Blog</h3>
      <form onsubmit="submitBlog(event)">
        <input type="hidden" id="blog-id">
        <div class="form-group">
          <label>Title</label>
          <input type="text" id="blog-title" class="form-control" required>
        </div>
        <div class="form-group">
          <label>Content</label>
          <textarea id="blog-content" class="form-control" rows="5" required></textarea>
        </div>
        <div class="form-group">
          <label>Category</label>
          <input type="text" id="blog-category" class="form-control">
        </div>
        <button type="submit" class="btn btn-primary mt-2">Save</button>
        <button type="button" class="btn btn-secondary mt-2" onclick="hideForm()">Cancel</button>
      </form>
    </div>
  </div>

  <script>
    const API_ROOT = 'http://127.0.0.1:8000/api';
    const accessToken = localStorage.getItem('access_token');
    const adminUUID = localStorage.getItem('admin_uuid');

    if (!accessToken || !adminUUID) {
      alert("You're not logged in.");
      window.location.href = 'login.html';
    }

    function getAuthHeaders() {
      return {
        'Authorization': `Bearer ${accessToken}`,
        'Content-Type': 'application/json'
      };
    }

    async function authFetch(url, options = {}) {
      const res = await fetch(`${API_ROOT}${url}`, {
        ...options,
        headers: getAuthHeaders()
      });

      if (res.status === 401) {
        alert("Session expired. Please log in again.");
        window.location.href = 'login.html';
        return;
      }
      return res.json();
    }

    async function loadBlogs() {
      const blogs = await authFetch(`/${adminUUID}/admin/blogs/`);
      console.log(blogs);
      const out = document.getElementById('output');
      out.innerHTML = `<h3>My Blogs</h3>
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>ID</th>
              <th>Title</th>
              <th>Content (preview)</th>
              <th>Published</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${blogs.map(blog => `
              <tr>
                <td>${blog.id}</td>
                <td>${blog.title}</td>
                <td>${(blog.content || '').substring(0, 100)}...</td>
                <td><button class="btn btn-sm btn-${blog.published ? 'success' : 'secondary'}">
                  ${blog.published ? 'Published' : 'Unpublished'}
                </button></td>
                <td>
                  <div class="dropdown">
                    <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton${blog.id}" data-bs-toggle="dropdown" aria-expanded="false">
                      &#8942;
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton${blog.id}">
                      <li><a class="dropdown-item" href="#" onclick='editBlog(${JSON.stringify(blog)})'>Edit</a></li>
                      <li><a class="dropdown-item" href="#" onclick='deleteBlog(${blog.id})'>Delete</a></li>
                      <li><a class="dropdown-item" href="#">Regenerate</a></li>
                    </ul>
                  </div>
                </td>
              </tr>`).join('')}
          </tbody>
        </table>`;
    }

    function showCreateForm() {
      document.getElementById('form-title').innerText = 'Create Blog';
      document.getElementById('blog-id').value = '';
      document.getElementById('blog-title').value = '';
      document.getElementById('blog-content').value = '';
      document.getElementById('blog-category').value = '';
      document.getElementById('form-area').style.display = 'block';
    }

    function editBlog(blog) {
      document.getElementById('form-title').innerText = 'Edit Blog';
      document.getElementById('blog-id').value = blog.id;
      document.getElementById('blog-title').value = blog.title;
      document.getElementById('blog-content').value = blog.content;
      document.getElementById('blog-category').value = blog.category;
      document.getElementById('form-area').style.display = 'block';
    }

    function hideForm() {
      document.getElementById('form-area').style.display = 'none';
    }

    async function submitBlog(e) {
      e.preventDefault();
      const id = document.getElementById('blog-id').value;
      const title = document.getElementById('blog-title').value;
      const content = document.getElementById('blog-content').value;
      const category = document.getElementById('blog-category').value;

      const blog = { title, content, category };

      const method = id ? 'PUT' : 'POST';
      const url = id
        ? `/${adminUUID}/admin/blogs/${id}/`
        : `/${adminUUID}/admin/blogs/`;

      await authFetch(url, {
        method,
        body: JSON.stringify(blog)
      });

      hideForm();
      loadBlogs();
    }

    async function deleteBlog(id) {
      if (!confirm('Are you sure?')) return;
      await authFetch(`/${adminUUID}/admin/blogs/${id}/`, {
        method: 'DELETE'
      });
      loadBlogs();
    }

    async function loadProfile() {
      const profile = await authFetch(`/${adminUUID}/admin/profil/`);
      const out = document.getElementById('output');
      out.innerHTML = `
        <h3>Admin Profile</h3>
        <p><strong>Username:</strong> ${profile.username}</p>
        <p><strong>Email:</strong> ${profile.email}</p>`;
    }

    function logout() {
      localStorage.clear();
      window.location.href = 'login.html';
    }
  </script>

  <script src="js/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
</body>
</html> -->


<!--                                                                               -->
<!--                                                                               -->
<!--                                                                               -->
<!--                                                                               -->
<!--                                                                               -->
<!--                                                                               -->
<!--                                                                               -->

<!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/bootstrap.css">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="container mt-5">
    <h1>Admin Dashboard</h1>

    <div class="mb-3">
      <button class="btn btn-primary" onclick="loadBlogs()">Load My Blogs</button>
      <button class="btn btn-success" onclick="showCreateForm()">+ Create Blog</button>
      <button class="btn btn-warning" onclick="loadComments()">View Comments</button>
      <button class="btn btn-info" onclick="loadProfile()">My Profile</button>
      <button class="btn btn-danger" onclick="logout()">Logout</button>
    </div>

    <div id="output"></div>

    <div id="form-area" style="display:none;">
      <h3 id="form-title">Create Blog</h3>
      <form onsubmit="submitBlog(event)">
        <input type="hidden" id="blog-id">
        <div class="form-group">
          <label>Title</label>
          <input type="text" id="blog-title" class="form-control" required>
        </div>
        <div class="form-group">
          <label>Content</label>
          <textarea id="blog-content" class="form-control" rows="5" required></textarea>
        </div>
        <div class="form-group">
          <label>Category</label>
          <input type="text" id="blog-category" class="form-control">
        </div>
        <button type="submit" class="btn btn-primary">Save</button>
        <button type="button" class="btn btn-secondary" onclick="hideForm()">Cancel</button>
      </form>
    </div>
  </div>

  <script>
    const API_ROOT = 'http://127.0.0.1:8000/api';
    const accessToken = localStorage.getItem('access_token');
    const adminUUID = localStorage.getItem('admin_uuid');

    if (!accessToken || !adminUUID) {
      alert("You're not logged in.");
      window.location.href = 'login.html';
    }

    function getAuthHeaders() {
      return {
        'Authorization': `Bearer ${accessToken}`,
        'Content-Type': 'application/json'
      };
    }

    async function authFetch(url, options = {}) {
      const res = await fetch(`${API_ROOT}${url}`, {
        ...options,
        headers: getAuthHeaders()
      });

      if (res.status === 401) {
        alert("Session expired. Please log in again.");
        window.location.href = 'login.html';
        return;
      }
      return res.json();
    }

    async function loadBlogs() {
      const blogs = await authFetch(`/${adminUUID}/admin/blogs/`);
      console.log(blogs)
      const out = document.getElementById('output');
      out.innerHTML = `<h3>My Blogs</h3>` + blogs.map(blog => `
        <div class="card mb-3">
          <div class="card-body">
            <h5>${blog.title}</h5>
            <p>${(blog.content || '').substring(0, 100)}...</p>
            <button class="btn btn-sm btn-info" onclick='editBlog(${JSON.stringify(blog)})'>Edit</button>
            <button class="btn btn-sm btn-danger" onclick='deleteBlog(${blog.id})'>Delete</button>
          </div>
        </div>`).join('');
    }

    function showCreateForm() {
      document.getElementById('form-title').innerText = 'Create Blog';
      document.getElementById('blog-id').value = '';
      document.getElementById('blog-title').value = '';
      document.getElementById('blog-content').value = '';
      document.getElementById('blog-category').value = '';
      document.getElementById('form-area').style.display = 'block';
    }

    function editBlog(blog) {
      document.getElementById('form-title').innerText = 'Edit Blog';
      document.getElementById('blog-id').value = blog.id;
      document.getElementById('blog-title').value = blog.title;
      document.getElementById('blog-content').value = blog.content;
      document.getElementById('blog-category').value = blog.category;
      document.getElementById('form-area').style.display = 'block';
    }

    function hideForm() {
      document.getElementById('form-area').style.display = 'none';
    }

    async function submitBlog(e) {
      e.preventDefault();
      const id = document.getElementById('blog-id').value;
      const title = document.getElementById('blog-title').value;
      const content = document.getElementById('blog-content').value;
      const category = document.getElementById('blog-category').value;

      const blog = { title, content, category };

      const method = id ? 'PUT' : 'POST';
      const url = id
        ? `/${adminUUID}/admin/blogs/${id}/`
        : `/${adminUUID}/admin/blogs/`;

      await authFetch(url, {
        method,
        body: JSON.stringify(blog)
      });

      hideForm();
      loadBlogs();
    }

    async function deleteBlog(id) {
      if (!confirm('Are you sure?')) return;
      await authFetch(`/${adminUUID}/admin/blogs/${id}/`, {
        method: 'DELETE'
      });
      loadBlogs();
    }

    async function loadComments() {
      const comments = await authFetch(`/${adminUUID}/admin/comments/`);
      const out = document.getElementById('output');
      out.innerHTML = `<h3>Comments</h3>` + comments.map(c => `
        <div class="card mb-2">
          <div class="card-body">
            <p><strong>ID ${c.id}</strong>: ${c.text}</p>
            <button class="btn btn-sm btn-danger" onclick='deleteComment(${c.id})'>Delete</button>
          </div>
        </div>`).join('');
    }

    async function deleteComment(id) {
      await authFetch(`/${adminUUID}/admin/comments/${id}/`, {
        method: 'DELETE'
      });
      loadComments();
    }

    async function loadProfile() {
      const profile = await authFetch(`/${adminUUID}/admin/profil/`);
      const out = document.getElementById('output');
      out.innerHTML = `
        <h3>Admin Profile</h3>
        <p><strong>Username:</strong> ${profile.username}</p>
        <p><strong>Email:</strong> ${profile.email}</p>`;
    }

    function logout() {
      localStorage.clear();
      window.location.href = 'login.html';
    }
  </script>

  <script src="js/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
</body>
</html> -->


