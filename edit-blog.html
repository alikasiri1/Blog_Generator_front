<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Editor - JSON to Editable Cards</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="icon" href="img/favicons/favicon_light.ico" sizes="32x32" data-next-head="">
    <link rel="icon" type="image/svg+xml" href="img/favicon_dark.svg" media="(prefers-color-scheme: dark)" data-next-head="">
    <link rel="icon" type="image/svg+xml" href="img/favicon_light.svg" media="(prefers-color-scheme: light)" data-next-head="">
    <!-- <link href="css/sb-admin-2.css" rel="stylesheet"> -->
    <style>
        .nav-item .nav-link {
          color: #002253;
          padding-left: 16px;
          padding-right: 16px;
        }
        .nav-item:focus , .nav-item:hover {
          background-color: #e7f1ff;
          border-radius: 28px;
        }
        @media (min-width: 1300px) {
          .content {
            padding-left: 100px;
            padding-right: 100px;
          }
        }
        @media (min-width: 1300px) {
          .navbar {
            padding-left: 100px;
            padding-right: 100px;
          }
        }
        /* CSS Variables for Theming */
        :root {
            --color-bg: #f8f9fa;
            --color-card-bg: #ffffff;
            --color-text: #2c3e50;
            --color-heading: #1a1a1a;
            --color-primary: #667eea;
            --color-primary-hover: #5568d3;
            --color-border: #e1e8ed;
            --color-shadow: rgba(0, 0, 0, 0.08);
            --color-toolbar-bg: #ffffff;
            --color-toolbar-hover: #f0f0f0;
            
            --font-heading: 'Georgia', serif;
            --font-body: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            --heading-placeholder: "ÿπŸÜŸàÿßŸÜ ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ...";
            --content-placeholder: "ŸÜŸàÿ¥ÿ™ŸÜ ÿ±ÿß ÿ¥ÿ±Ÿàÿπ ⁄©ŸÜ€åÿØ...";
            --media-placeholder: "ÿØÿ±ÿ≠ÿßŸÑ ÿ™ŸàŸÑ€åÿØ ÿ±ÿ≥ÿßŸÜŸá";
            --radius: 16px;
            --shadow-sm: 0 2px 8px var(--color-shadow);
            --shadow-md: 0 4px 16px var(--color-shadow);
            --shadow-lg: 0 8px 32px var(--color-shadow);
            
            --container-width: 1100px;
        }

        /* Theme: Dark */
        [data-theme="dark"] {
            --color-bg: #1a1a2e;
            --color-card-bg: #16213e;
            --color-text: #e4e4e7;
            --color-heading: #ffffff;
            --color-primary: #7c3aed;
            --color-primary-hover: #6d28d9;
            --color-border: #2d3748;
            --color-shadow: rgba(0, 0, 0, 0.3);
            --color-toolbar-bg: #9a9aee;
            --color-toolbar-hover: #1e293b;
        }

        /* Theme: Minimalist */
        [data-theme="minimalist"] {
            --color-bg: #fafafa;
            --color-card-bg: #ffffff;
            --color-text: #333333;
            --color-heading: #000000;
            --color-primary: #000000;
            --color-primary-hover: #333333;
            --color-border: #d4d4d4;
            --color-shadow: rgba(0, 0, 0, 0.05);
            --color-toolbar-bg: #ffffff;
            --color-toolbar-hover: #f5f5f5;
            
            --font-heading: 'Helvetica Neue', Arial, sans-serif;
            --font-body: 'Helvetica Neue', Arial, sans-serif;
        }

        /* Theme: Warm */
        [data-theme="warm"] {
            --color-bg: #fff8f0;
            --color-card-bg: #ffffff;
            --color-text: #5c4033;
            --color-heading: #3e2723;
            --color-primary: #ff6b35;
            --color-primary-hover: #e85d2f;
            --color-border: #f4e4d7;
            --color-shadow: rgba(255, 107, 53, 0.1);
            --color-toolbar-bg: #fffbf7;
            --color-toolbar-hover: #fff0e0;
            
            --font-heading: 'Palatino', 'Book Antiqua', serif;
            --font-body: 'Trebuchet MS', sans-serif;
        }

        /* Theme: Ocean */
        [data-theme="ocean"] {
            --color-bg: #e0f4ff;
            --color-card-bg: #ffffff;
            --color-text: #1a3a3a;
            --color-heading: #0d4d5c;
            --color-primary: #0ea5e9;
            --color-primary-hover: #0284c7;
            --color-border: #bae6fd;
            --color-shadow: rgba(14, 165, 233, 0.1);
            --color-toolbar-bg: #f0f9ff;
            --color-toolbar-hover: #e0f2fe;
            
            --font-heading: 'Trebuchet MS', sans-serif;
            --font-body: 'Arial', sans-serif;
        }

        /* Theme: Forest */
        [data-theme="forest"] {
            --color-bg: #f0fdf4;
            --color-card-bg: #ffffff;
            --color-text: #1b4332;
            --color-heading: #081c15;
            --color-primary: #22c55e;
            --color-primary-hover: #16a34a;
            --color-border: #dcfce7;
            --color-shadow: rgba(34, 197, 94, 0.1);
            --color-toolbar-bg: #f7fee7;
            --color-toolbar-hover: #ecfdf5;
            
            --font-heading: 'Georgia', serif;
            --font-body: 'Verdana', sans-serif;
        }

        /* Theme: Sunset */
        [data-theme="sunset"] {
            --color-bg: #fef2f2;
            --color-card-bg: #ffffff;
            --color-text: #7c2d12;
            --color-heading: #431407;
            --color-primary: #ea580c;
            --color-primary-hover: #c2410c;
            --color-border: #fed7aa;
            --color-shadow: rgba(234, 88, 12, 0.1);
            --color-toolbar-bg: #fef3c7;
            --color-toolbar-hover: #fde68a;
            
            --font-heading: 'Times New Roman', serif;
            --font-body: 'Comic Sans MS', cursive;
        }

        /* Theme: Purple Haze */
        [data-theme="purple-haze"] {
            --color-bg: #f5f3ff;
            --color-card-bg: #ffffff;
            --color-text: #4c1d95;
            --color-heading: #2e1065;
            --color-primary: #a78bfa;
            --color-primary-hover: #9f7aea;
            --color-border: #e9d5ff;
            --color-shadow: rgba(167, 139, 250, 0.1);
            --color-toolbar-bg: #faf5ff;
            --color-toolbar-hover: #f3e8ff;
            
            --font-heading: 'Palatino', serif;
            --font-body: 'Georgia', serif;
        }

        /* Theme: Monochrome */
        [data-theme="monochrome"] {
            --color-bg: #f5f5f5;
            --color-card-bg: #ffffff;
            --color-text: #424242;
            --color-heading: #000000;
            --color-primary: #757575;
            --color-primary-hover: #616161;
            --color-border: #e0e0e0;
            --color-shadow: rgba(0, 0, 0, 0.12);
            --color-toolbar-bg: #fafafa;
            --color-toolbar-hover: #eeeeee;
            
            --font-heading: 'Arial', sans-serif;
            --font-body: 'Arial', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
            transition: background 0.3s ease, color 0.3s ease;
            min-height: 100vh;
        }

        /* RTL support for Farsi */
        body[dir="rtl"] {
            direction: rtl;
        }

        body[dir="rtl"] .toolbar-group {
            border-right: none;
            border-left: 1px solid var(--color-border);
            padding-right: 0;
            padding-left: 0.5rem;
        }

        body[dir="rtl"] .toolbar-group:last-child {
            border-left: none;
        }

        /* Header */
        .header {
            background: var(--color-card-bg);
            border-bottom: 1px solid var(--color-border);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-heading);
            font-family: var(--font-heading);
        }

        .header-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        /* Buttons */
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: var(--font-body);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--color-card-bg);
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }

        .btn-secondary:hover {
            background: var(--color-toolbar-hover);
        }

        .btn-icon {
            padding: 0.5rem;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Container */
        .container {
            max-width: var(--container-width);
            margin: 2rem auto;
            padding: 0 1rem;
            transition: max-width 0.3s ease;
            margin-top: 72px;
        }

        /* Container width control */
        .width-control {
            background: var(--color-card-bg);
            border: 1px solid var(--color-border);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: var(--shadow-sm);
        }

        .width-control-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--color-heading);
            white-space: nowrap;
        }

        .width-slider {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: var(--color-border);
            outline: none;
            -webkit-appearance: none;
        }

        .width-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--color-primary);
            cursor: pointer;
        }

        .width-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--color-primary);
            cursor: pointer;
            border: none;
        }

        .width-value {
            font-size: 0.875rem;
            color: var(--color-text);
            min-width: 60px;
            text-align: center;
        }

        /* Cards Container */
        .cards-container {
            /* background-color: var(--color-card-bg); */
            display: flex;
            flex-direction: column;
            border-radius: var(--radius);
            /* margin-bottom: 1.5rem; */
            /* box-shadow: var(--shadow-sm); */
        }

        /* Card divider for inserting new cards */
        .card-divider {
            position: relative;
            height: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
            transition: opacity 0.2s ease;
        }

        /* .card-divider:hover {
            opacity: 1;
        } */

        .card-divider-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background: var(--color-border);
        }

        .card-divider-buttons {
            position: relative;
            display: flex;
            /* display: none; */
            gap: 0.5rem;
            /* background: var(--color-bg); */
            padding: 0 1rem;
            z-index: 1;
        }

        .insert-card-button {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid var(--color-primary);
            background: var(--color-card-bg);
            color: var(--color-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.2s ease;
        }

        .insert-card-button:hover {
            background: var(--color-primary);
            color: white;
            transform: scale(1.1);
        }

        /* Card */
        .card {
            background: var(--color-card-bg);
            border-radius: var(--radius);
            padding: 2rem;
            transition: all 0.3s ease;
            position: relative;
            border: 2px solid transparent;
        }

        .card:hover {
            /* box-shadow: var(--shadow-md); */
        }

        .card.dragging {
            opacity: 0.5;
            cursor: move;
        }

        .card.drag-over {
            border-color: var(--color-primary);
        }

        /* Card top bar with drag handle and menu */
        .card-top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            /* margin-bottom: 0.5rem;  */
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .card:hover .card-top-bar {
            opacity: 1;
        }

        .drag-handle {
            cursor: move;
            color: var(--color-text);
            font-size: 1.2rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            transition: background 0.2s ease;
        }

        .drag-handle:hover {
            background: var(--color-toolbar-hover);
        }

        .card-menu-wrapper {
            position: relative;
        }

        .card-menu-button {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            color: var(--color-text);
            font-size: 1.2rem;
        }

        .card-menu-button:hover {
            background: var(--color-toolbar-hover);
        }

        .card-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background: var(--color-card-bg);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            min-width: 180px;
            display: none;
            z-index: 10;
        }

        body[dir="rtl"] .card-menu {
            right: auto;
            left: 0;
        }

        .card-menu.active {
            display: block;
        }

        .card-menu-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            color: var(--color-text);
        }

        body[dir="rtl"] .card-menu-item {
            text-align: right;
        }

        .card-menu-item:hover {
            background: var(--color-toolbar-hover);
        }

        .card-menu-item:first-child {
            border-radius: 8px 8px 0 0;
        }

        .card-menu-item:last-child {
            border-radius: 0 0 8px 8px;
        }

        .card-menu-item.danger {
            color: #ef4444;
        }

        /* Card Header */
        .card-header_ {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
            gap: 1rem;
        }

        .card-heading {
            font-family: var(--font-heading);
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--color-heading);
            outline: none;
            flex: 1;
            border: 2px solid transparent;
            padding: 0.25rem;
            border-radius: 4px;
            transition: border-color 0.2s ease;
            overflow: auto;
            overflow-wrap: break-word;
        }

        .card-heading:focus {
            border-color: var(--color-primary);
        }

        .card-heading:empty:before {
            /* content: 'Enter heading...'; */
            content: var(--heading-placeholder, "ÿπŸÜŸàÿßŸÜ ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ...");
            color: #999;
        }
        .media-placholder:empty::before {
            content: var(--media-placeholder);
        }
        /* Card Actions */
        .card-actions {
            display: flex;
            gap: 0.25rem;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .card:hover .card-actions {
            opacity: 1;
        }

        .card-action-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: var(--color-toolbar-bg);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            color: var(--color-text);
        }

        .card-action-btn:hover {
            background: var(--color-toolbar-hover);
            transform: scale(1.1);
        }

        /* Card Content */
        .card-content-wrapper {
            display: flex;
            gap: 1.5rem;
            align-items: flex-start;
        }

        .card-content-wrapper.image-top,
        .card-content-wrapper.image-bottom {
            /* flex-direction: column; */
        }

        .card-content-wrapper.image-left {
            flex-direction: row;
        }

        .card-content-wrapper.image-right {
            flex-direction: row-reverse;
        }

        .card-content {
            outline: none;
            line-height: 1.8;
            flex: 1;
            min-height: 60px;
            border: 2px solid transparent;
            padding: 0.5rem;
            border-radius: 4px;
            transition: border-color 0.2s ease;
            overflow: auto;
            overflow-wrap: break-word;
            color: var(--color-text);
        }

        .card-content:focus {
            border-color: var(--color-primary);
        }

        .card-content:empty:before {
            /* content: 'Start writing...'; */
            content: var(--content-placeholder, "ŸÜŸàÿ¥ÿ™ŸÜ ÿ±ÿß ÿ¥ÿ±Ÿàÿπ ⁄©ŸÜ€åÿØ...");
            color: #999;
        }

        /* Resizable Image Container */
        .card-image-container {
            position: relative;
            max-width: 100%;
            min-width: 100px;
            min-height: 100px;
        }

        .card-content-wrapper.image-left .card-image-container,
        .card-content-wrapper.image-right .card-image-container {
            max-width: 600px;
            flex-shrink: 0;
        }

        .card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
            display: block;
        }

        .image-placeholder {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
            opacity: 0.3;
        }

        .card-content-wrapper.image-left .image-placeholder,
        .card-content-wrapper.image-right .image-placeholder {
            height: 150px;
        }

        .image-remove-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: 2;
        }

        body[dir="rtl"] .image-remove-btn {
            right: auto;
            left: 8px;
        }

        .card-image-container:hover .image-remove-btn {
            opacity: 1;
        }

        /* Resize handles for images */
        .resize-handle {
            position: absolute;
            background: var(--color-primary);
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: 1;
        }

        .card-image-container:hover .resize-handle {
            opacity: 1;
        }

        .resize-handle-e {
            right: -4px;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 40px;
            cursor: ew-resize;
            border-radius: 4px;
        }

        .resize-handle-s {
            bottom: -4px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 8px;
            cursor: ns-resize;
            border-radius: 4px;
        }

        .resize-handle-se {
            right: -4px;
            bottom: -4px;
            width: 12px;
            height: 12px;
            cursor: nwse-resize;
            border-radius: 50%;
        }

        body[dir="rtl"] .resize-handle-e {
            right: auto;
            left: -4px;
        }

        body[dir="rtl"] .resize-handle-se {
            right: auto;
            left: -4px;
        }

        /* Image Controls */
        .image-controls {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--color-bg);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .image-controls-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--color-heading);
        }

        .image-position-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .image-position-btn {
            padding: 0.5rem 1rem;
            border: 2px solid var(--color-border);
            background: var(--color-card-bg);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            color: var(--color-text);
        }

        .image-position-btn.active {
            border-color: var(--color-primary);
            background: var(--color-primary);
            color: white;
        }

        .image-position-btn:hover:not(.active) {
            border-color: var(--color-primary);
        }

        /* Toolbar */
        .toolbar {
            position: sticky;
            top: 73px;
            background: var(--color-toolbar-bg);
            border: 1px solid var(--color-border);
            border-radius: 12px;
            padding: 0.75rem;
            margin-bottom: 1.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            box-shadow: var(--shadow-md);
            z-index: 50;
            transition: all 0.3s ease;
        }

        .toolbar-group {
            display: flex;
            gap: 0.25rem;
            padding-right: 0.5rem;
            border-right: 1px solid var(--color-border);
        }

        .toolbar-group:last-child {
            border-right: none;
        }

        .toolbar-btn {
            width: 36px;
            height: 36px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            color: var(--color-text);
            font-weight: 600;
        }

        .toolbar-btn:hover {
            background: var(--color-toolbar-hover);
        }

        .toolbar-btn.active {
            background: var(--color-primary);
            color: white;
        }

        .toolbar-select {
            padding: 0.5rem;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            background: var(--color-card-bg);
            color: var(--color-text);
            font-family: var(--font-body);
            cursor: pointer;
        }

        .toolbar-input {
            width: 50px;
            padding: 0.5rem;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            background: var(--color-card-bg);
            color: var(--color-text);
            font-family: var(--font-body);
        }

        .color-picker-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .color-picker {
            width: 36px;
            height: 36px;
            border: 2px solid var(--color-border);
            border-radius: 6px;
            cursor: pointer;
        }

        /* Add Card Button */
        .add-card-btn {
            width: 100%;
            padding: 1.5rem;
            border: 2px dashed var(--color-border);
            background: transparent;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 1rem;
            color: var(--color-text);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }

        .add-card-btn:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
            background: var(--color-bg);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--color-card-bg);
            border-radius: var(--radius);
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--color-heading);
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .modal-footer {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--color-heading);
        }

        .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            background: var(--color-card-bg);
            color: var(--color-text);
            font-family: var(--font-body);
        }

        /* Preview Mode */
        body.preview-mode .toolbar,
        body.preview-mode .card-actions,
        body.preview-mode .add-card-btn,
        body.preview-mode .image-controls,
        body.preview-mode .card-divider,
        body.preview-mode .card-top-bar,
        body.preview-mode .resize-handle,
        body.preview-mode .width-control {
            display: none !important;
        }

        body.preview-mode .card-heading,
        body.preview-mode .card-content {
            border: none;
            cursor: default;
        }

        body.preview-mode .card-heading:focus,
        body.preview-mode .card-content:focus {
            border: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                align-items: stretch;
            }

            .header-actions {
                justify-content: center;
            }

            .toolbar {
                top: auto;
                position: relative;
            }

            .card {
                padding: 1.5rem;
            }

            .card-heading {
                font-size: 1.5rem;
            }

            .card-content-wrapper.image-left,
            .card-content-wrapper.image-right {
                flex-direction: column;
            }

            .card-content-wrapper.image-left .card-image-container,
            .card-content-wrapper.image-right .card-image-container {
                max-width: 100%;
            }
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            animation: slideIn 0.3s ease;
        }

        /* Drag Handle - kept from original, but functionality is now on .card-top-bar's .drag-handle */
        .drag-handle {
            cursor: move;
            color: var(--color-text);
            opacity: 0.5;
            transition: opacity 0.2s ease;
        }

        .card:hover .drag-handle {
            opacity: 1;
        }

        /* Author Info and Recent Posts Sections */
        .author-info, .recent-posts {
            background: var(--color-card-bg);
            border-radius: var(--radius);
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-sm);
            position: relative;
        }

        .author-info {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .author-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--color-primary) 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            flex-shrink: 0;
        }

        .author-details {
            flex: 1;
        }

        .author-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--color-heading);
            margin-bottom: 0.25rem;
        }

        .author-bio {
            color: var(--color-text);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .author-links {
            display: flex;
            gap: 0.75rem;
        }

        .author-link {
            color: var(--color-primary);
            text-decoration: none;
            font-size: 0.875rem;
            transition: color 0.2s ease;
        }

        .author-link:hover {
            color: var(--color-primary-hover);
        }

        .recent-posts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .recent-posts-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-heading);
        }

        .recent-posts-link {
            color: var(--color-primary);
            text-decoration: none;
            font-size: 0.875rem;
            transition: color 0.2s ease;
        }

        .recent-posts-link:hover {
            color: var(--color-primary-hover);
        }

        .recent-posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .recent-post-item {
            border: 1px solid var(--color-border);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .recent-post-item:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .recent-post-image {
            width: 100%;
            height: 150px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
        }

        .recent-post-content {
            padding: 1rem;
        }

        .recent-post-title {
            font-weight: 600;
            color: var(--color-heading);
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .recent-post-excerpt {
            color: var(--color-text);
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .section-toggle-menu {
            position: absolute;
            top: 1rem;
            right: 1rem;
        }

        body[dir="rtl"] .section-toggle-menu {
            right: auto;
            left: 1rem;
        }

        .section-menu-button {
            width: 28px;
            height: 28px;
            border: none;
            background: var(--color-toolbar-bg);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            color: var(--color-text);
            font-size: 1.2rem;
            box-shadow: var(--shadow-sm);
        }

        .section-menu-button:hover {
            background: var(--color-toolbar-hover);
        }

        .section-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background: var(--color-card-bg);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            min-width: 200px;
            display: none;
            z-index: 10;
        }

        body[dir="rtl"] .section-menu {
            right: auto;
            left: 0;
        }

        .section-menu.active {
            display: block;
        }

        .section-menu-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            color: var(--color-text);
        }

        body[dir="rtl"] .section-menu-item {
            text-align: right;
        }

        .section-menu-item:hover {
            background: var(--color-toolbar-hover);
        }

        .section-menu-item input[type="checkbox"] {
            margin: 0;
        }

        /* Hide sections when not visible in preview */
        body.preview-mode .author-info.hidden,
        body.preview-mode .recent-posts.hidden {
            display: none;
        }

        /* Show toggle menus only in preview mode */
        body.preview-mode .section-toggle-menu {
            display: none;
        }
        .nav-item .nav-link {
          color: #002253;
          padding-left: 16px;
          padding-right: 16px;
        }
        .nav-item:focus , .nav-item:hover {
          background-color: #e7f1ff;
          border-radius: 28px;
        }


        #mediaGeneratorBox {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            background: #fff;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0px 4px 12px rgba(0,0,0,0.15);
            display: none;
            z-index: 9999;
        }
        #mediaGeneratorBox textarea {
            width: 100%;
            height: 80px;
            border-radius: 8px;
            padding: 10px;
            resize: none;
        }
        #mediaGeneratorBox button {
            width: 100%;
            padding: 10px;
            border: none;
            background: #007bff;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
        }
        #mediaCloseBtn {
            float: right;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            margin-top: -5px;
        }
        #mediaCloseBtn:hover {
            color: red;
        }
    </style>    

</head>
<body>

    <nav class="navbar navbar-expand-lg fixed-top bootstrap-scope" style="background-color: rgba(255, 255, 255, 0.95);direction: ltr;">
        <div class="container-fluid">
            <a class="navbar-brand" style="color: #0540ad;" href="index.html">
              gamma
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" 
                    data-bs-target="#navbarSupportedContent" 
                    aria-controls="navbarSupportedContent" 
                    aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item ml-2">
                  <a class="nav-link" aria-current="page" href="admin.html" style="padding-left: 16px;padding-right: 16px;" data-label="home">ÿÆÿßŸÜŸá</a>
                </li>
                <!-- <li class="nav-item ml-2">
                  <a class="nav-link" href="#" style="padding-left: 16px;padding-right: 16px;" data-label="link">ŸÑ€åŸÜ⁄©</a>
                </li> -->
                <!-- <li class="nav-item dropdown ml-2">
                  <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" 
                     data-bs-toggle="dropdown" aria-expanded="false" style="padding-left: 16px;padding-right: 16px;" data-label="dropdown">ŸÖŸÜŸà</a>
                  <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <li><a class="dropdown-item" href="#" data-label="action">ÿπŸÖŸÑ€åÿßÿ™</a></li>
                    <li><a class="dropdown-item" href="#" data-label="another">ÿπŸÖŸÑ€åÿßÿ™ ÿØ€å⁄Øÿ±</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="#" data-label="something">⁄Ü€åÿ≤€å ÿØ€å⁄Øÿ±</a></li>
                  </ul>
                </li> -->
                <li class="nav-item ml-2 dropdown">
                  <a class="nav-link dropdown-toggle" href="#" id="themeDropdown" role="button" 
                     data-bs-toggle="dropdown" aria-expanded="false" style="padding-left: 16px;padding-right: 16px;" data-label="theme">
                      ÿ™ŸÖ</a>
                  <ul class="dropdown-menu" aria-labelledby="themeDropdown">
                    <li><a class="dropdown-item" href="#" onclick="setTheme('light')" data-label="light">ÿ±Ÿàÿ¥ŸÜ</a></li>
                    <li><a class="dropdown-item" href="#" onclick="setTheme('dark')" data-label="dark">ÿ™ÿßÿ±€å⁄©</a></li>
                    <li><a class="dropdown-item" href="#" onclick="setTheme('minimalist')" data-label="minimalist">ÿ≠ÿØÿßŸÇŸÑ</a></li>
                    <li><a class="dropdown-item" href="#" onclick="setTheme('warm')" data-label="warm">⁄Øÿ±ŸÖ</a></li>
                    <li><a class="dropdown-item" href="#" onclick="setTheme('ocean')" data-label="ocean">ÿßŸÇ€åÿßŸÜŸàÿ≥</a></li>
                    <li><a class="dropdown-item" href="#" onclick="setTheme('forest')" data-label="forest">ÿ¨ŸÜ⁄ØŸÑ</a></li>
                    <li><a class="dropdown-item" href="#" onclick="setTheme('sunset')" data-label="sunset">ÿ∫ÿ±Ÿàÿ®</a></li>
                    <li><a class="dropdown-item" href="#" onclick="setTheme('purple-haze')" data-label="purple">ÿ®ŸÜŸÅÿ¥</a></li>
                    <li><a class="dropdown-item" href="#" onclick="setTheme('monochrome')" data-label="monochrome">ÿ™⁄© ÿ±ŸÜ⁄Ø</a></li>
                  </ul>
                </li>
              </ul>
              <ul class="navbar-nav">
                  <li class="nav-item ml-2">
                      <a class="nav-link" id="langBtn" href="#" style="padding-left: 16px;padding-right: 16px;" data-label="lang">üåê EN</a>
                    </li>
                <li class="nav-item ml-2">
                  <a class="nav-link" id="previewBtn" href="#" style="padding-left: 16px;padding-right: 16px;" data-label="preview">Ÿæ€åÿ¥‚ÄåŸÜŸÖÿß€åÿ¥</a>
                </li>
                <li class="nav-item ml-2">
                  <a class="nav-link" id="publishBtn" href="#" style="background-color: #0540ad;color: #f8f9fc;padding-left: 16px;padding-right: 16px;border-radius: 28px;border: none;box-sizing: unset;cursor:pointer;" data-label="publish">ÿßŸÜÿ™ÿ¥ÿßÿ±</a>
                </li>
                
              </ul>
              
            </div> 
          </div>
      </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Container width control -->
        <div class="width-control" style="direction: ltr;">
            <span class="width-control-label">Container Width:</span>
            <input type="range" class="width-slider" id="widthSlider" min="600" max="1400" value="900" step="50">
            <span class="width-value" id="widthValue">1100px</span>
        </div>

        <!-- Toolbar -->
        <div id="toolbar" class="toolbar" style="direction: ltr;">
            <div class="toolbar-group">
                <button class="toolbar-btn" data-command="bold" title="Bold (Ctrl+B)"><strong>B</strong></button>
                <button class="toolbar-btn" data-command="italic" title="Italic (Ctrl+I)"><em>I</em></button>
                <button class="toolbar-btn" data-command="underline" title="Underline (Ctrl+U)"><u>U</u></button>
            </div>
            <div class="toolbar-group">
                <button class="toolbar-btn" data-command="formatBlock" data-value="h1" title="Heading 1">H1</button>
                <button class="toolbar-btn" data-command="formatBlock" data-value="h2" title="Heading 2">H2</button>
                <button class="toolbar-btn" data-command="formatBlock" data-value="h3" title="Heading 3">H3</button>
                <button class="toolbar-btn" data-command="formatBlock" data-value="p" title="Paragraph">P</button>
            </div>
            <div class="toolbar-group">
                <button class="toolbar-btn" style="font-size: 1.5rem;" data-command="justifyLeft" title="Align Left">‚Üê</button>
                <button class="toolbar-btn" style="font-size: 1.5rem;" data-command="justifyCenter" title="Align Center">‚Üî</button>
                <button class="toolbar-btn" style="font-size: 1.5rem;" data-command="justifyRight" title="Align Right">‚Üí</button>
                <button class="toolbar-btn" style="font-size: 1.5rem;" data-command="justifyFull" title="Justify">‚Üï</button>
                <!-- <button class="toolbar-btn" style="font-size: 1.5rem;" data-command="directionltr" title="Left-to-Right">>¬∂</button>
                <button class="toolbar-btn" style="font-size: 1.5rem;" data-command="directionrtl" title="Right-to-Left"><¬∂</button> -->


            </div>
            <div class="toolbar-group">
                <button class="toolbar-btn" data-command="insertUnorderedList" title="Bullet List">‚Ä¢</button>
                <button class="toolbar-btn" data-command="insertOrderedList" title="Numbered List">1.</button>
            </div>
            <div class="toolbar-group">
                <select class="toolbar-select" id="fontFamily">
                    <option value="Arial">Arial</option>
                    <option value="Georgia">Georgia</option>
                    <option value="'Times New Roman'">Times New Roman</option>
                    <option value="'Courier New'">Courier New</option>
                    <option value="Verdana">Verdana</option>
                </select>
                <!-- Replace number input with select dropdown for font size -->
                <select class="toolbar-select" id="fontSize" title="Font Size">
                    <option value="">Size</option>
                    <option value="12">Small</option>
                    <option value="16">Normal</option>
                    <option value="24">Large</option>
                    <option value="32">Huge</option>
                </select>
            </div>
            <!-- <div class="toolbar-group">
                <div class="color-picker-wrapper">
                    <input type="color" class="color-picker" id="textColor" value="#2c3e50" title="Text Color">
                </div>
                <div class="color-picker-wrapper">
                    <input type="color" class="color-picker" id="bgColor" value="#ffffff" title="Background Color">
                </div>
            </div> -->
            <div class="toolbar-group">
                <button class="toolbar-btn" id="linkBtn" title="Insert Link">üîó</button>
            </div>
        </div>

        <!-- Add author info section (shown in preview mode) -->
        <div id="authorInfo" class="author-info" style="display: flex;">
            <div class="author-avatar">üë§</div>
            <div class="author-details">
                <div class="author-name"></div>
                <div class="author-bio"></div>
                <div class="author-links">
                    <a href="#" class="author-link">Website</a>
                    <a href="#" class="author-link">Twitter</a>
                    <a href="#" class="author-link">LinkedIn</a>
                </div>
            </div>
            <div class="section-toggle-menu">
                <button class="section-menu-button" onclick="toggleSectionMenu('author')" title="Section options">‚ãÆ</button>
                <div class="section-menu" id="authorMenu">
                    <label class="section-menu-item">
                        <input type="checkbox" id="showAuthorInfo" checked onchange="toggleAuthorVisibility()">
                        <span data-label="editProfile">ŸÜŸÖÿß€åÿ¥ ÿØÿ± ⁄Øÿ≤ÿßÿ±ÿ¥ ŸÜŸáÿß€å€å</span>
                    </label>
                    <a class="card-menu-item" style="text-decoration: none;" data-label="edit" href="profile.html">Ÿà€åÿ±ÿß€åÿ¥</a>
                </div>
            </div>
        </div>

        <!-- Cards Container -->
        <div id="cardsContainer" class="cards-container"></div>

        <!-- Add Card Button -->
        <!-- <button class="add-card-btn" id="addCardBtn">
            <span style="font-size: 1.5rem;">+</span>
            Add New Card
        </button> -->

        <!-- Add recent posts section (shown in preview mode) -->
        <div id="recentPosts" class="recent-posts" style="display: block;">
            <div class="recent-posts-header">
                <h2 class="recent-posts-title">Recent Posts</h2>
                <a href="#" class="recent-posts-link">See All</a>
            </div>
            <div class="recent-posts-grid">
                <div class="recent-post-item">
                    <div class="recent-post-image">üìù</div>
                    <div class="recent-post-content">
                        <div class="recent-post-title">Getting Started with Web Development</div>
                        <div class="recent-post-excerpt">Learn the fundamentals of building modern websites...</div>
                    </div>
                </div>
                <div class="recent-post-item">
                    <div class="recent-post-image">üé®</div>
                    <div class="recent-post-content">
                        <div class="recent-post-title">Design Principles for Beginners</div>
                        <div class="recent-post-excerpt">Master the basics of visual design and typography...</div>
                    </div>
                </div>
                <div class="recent-post-item">
                    <div class="recent-post-image">üí°</div>
                    <div class="recent-post-content">
                        <div class="recent-post-title">Creative Writing Tips</div>
                        <div class="recent-post-excerpt">Improve your writing skills with these proven techniques...</div>
                    </div>
                </div>
            </div>
            <div class="section-toggle-menu">
                <button class="section-menu-button" onclick="toggleSectionMenu('recent')" title="Section options">‚ãÆ</button>
                <div class="section-menu" id="recentMenu">
                    <label class="section-menu-item">
                        <input type="checkbox" id="showRecentPosts" checked onchange="toggleRecentVisibility()">
                        <span data-label="editProfile">ŸÜŸÖÿß€åÿ¥ ÿØÿ± ⁄Øÿ≤ÿßÿ±ÿ¥ ŸÜŸáÿß€å€å</span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Export Content</div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Export Format</label>
                    <select id="exportFormat" class="form-select">
                        <option value="json">JSON</option>
                        <option value="html">HTML</option>
                        <option value="markdown">Markdown</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelExportBtn">Cancel</button>
                <button class="btn btn-primary" id="confirmExportBtn">Download</button>
            </div>
        </div>
    </div>

    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content bg-light">
                <div class="modal-header" style="border-bottom-width: 0px;">
                    <h5 class="modal-title text-primary" id="exampleModalLabel" data-label="modal_ready">Ready to Leave?</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">√ó</span>
                    </button>
                </div>
                <div class="modal-body text-primary"><span data-label="modal_select">Select</span>
                    <span class="fw-bold"  data-label="modal_logout_text">logout</span> <span data-label="modal_end_session">below if you are ready to end your current session.</span></div>
                <div class="modal-footer" style="border-top-width: 0px;">
                    <!-- <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button> -->
                    <a class="d-sm-inline-block btn btn-md   border-1 text-light mr-2 mb-2" 
                    style="border-radius: 10px;" href="login.html" data-label="modal_logout_btn">Logout</a>
                </div>
            </div>
        </div>
    </div>


    <div id="mediaGeneratorBox">
        <span id="mediaCloseBtn" onclick="closeMediaBox()">√ó</span>
        <h4 style="margin: 0 0 10px;">ÿ™ŸàŸÑ€åÿØ ÿπ⁄©ÿ≥ €åÿß Ÿà€åÿØÿ¶Ÿà</h4>
    
        <!-- Media Type -->
        <label><b>ŸÜŸàÿπ:</b></label>
        <select id="mediaType" style="width: 100%; padding: 8px; border-radius: 6px;">
            <option value="image">ÿπ⁄©ÿ≥</option>
            <option value="video">Ÿà€åÿØÿ¶Ÿà</option>
        </select>
    
        <!-- Prompt Text -->
        <label style="margin-top: 10px;"><b>ÿ¥ÿ±ÿ≠:</b></label>
        <textarea id="mediaPrompt" placeholder="ÿ¥ÿ±ÿ≠ ÿπ⁄©ÿ≥ €åÿß Ÿà€åÿØÿ¶Ÿà ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ"></textarea>
    
        <button onclick="sendMediaRequest()">ÿ™ŸàŸÑ€åÿØ</button>
    
        <div id="mediaResult" style="margin-top: 10px; font-size: 14px;text-align: center;overflow: auto;"></div>
    </div>

    <!-- Load JSON Modal -->
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script>
        const translations = {
            fa: {
                home: 'ÿÆÿßŸÜŸá',
                link: 'ŸÑ€åŸÜ⁄©',
                dropdown: 'ŸÖŸÜŸà',
                action: 'ÿπŸÖŸÑ€åÿßÿ™',
                another: 'ÿπŸÖŸÑ€åÿßÿ™ ÿØ€å⁄Øÿ±',
                something: '⁄Ü€åÿ≤€å ÿØ€å⁄Øÿ±',
                theme: 'üé® ÿ™ŸÖ',
                light: 'ÿ±Ÿàÿ¥ŸÜ',
                dark: 'ÿ™ÿßÿ±€å⁄©',
                minimalist: 'ÿ≠ÿØÿßŸÇŸÑ',
                warm: '⁄Øÿ±ŸÖ',
                lang: 'üåê FA',
                preview: 'Ÿæ€åÿ¥‚ÄåŸÜŸÖÿß€åÿ¥',
                publish: 'ÿßŸÜÿ™ÿ¥ÿßÿ±',
                width: 'ÿπÿ±ÿ∂ ÿ∏ÿ±ŸÅ:',
                export: 'ÿµÿßÿØÿ±ÿßÿ™ ŸÖÿ≠ÿ™Ÿàÿß',
                exportFormat: 'ŸÅÿ±ŸÖÿ™ ÿµÿßÿØÿ±ÿßÿ™',
                cancel: 'ŸÑÿ∫Ÿà',
                download: 'ÿØÿßŸÜŸÑŸàÿØ',
                loadJson: 'ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å JSON',
                pasteJson: 'ŸÖÿ™ŸÜ JSON ÿ±ÿß ÿ®ŸæŸàÿ¥ÿ¥ ÿØŸá€åÿØ',
                load: 'ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å',
                edit: 'Ÿà€åÿ±ÿß€åÿ¥',
                editProfile: 'ŸÜŸÖÿß€åÿ¥ ÿØÿ± ⁄Øÿ≤ÿßÿ±ÿ¥ ŸÜŸáÿß€å€å'
            },
            en: {
                home: 'Home',
                link: 'Link',
                dropdown: 'Menu',
                action: 'Action',
                another: 'Another action',
                something: 'Something else',
                theme: 'üé® Theme',
                light: 'Light',
                dark: 'Dark',
                minimalist: 'Minimalist',
                warm: 'Warm',
                lang: 'üåê EN',
                preview: 'Preview',
                publish: 'Publish',
                width: 'Container Width:',
                export: 'Export Content',
                exportFormat: 'Export Format',
                cancel: 'Cancel',
                download: 'Download',
                loadJson: 'Load JSON',
                pasteJson: 'Paste JSON Array',
                load: 'Load',
                edit: 'Edit Profile',
                editProfile: 'Show in published blog'
            }
        };
        // State Management
        let cards = [];
        let draggedCard = null;
        let isPreviewMode = false;
        let currentLanguage = 'fa';
        let resizingImage = null;
        let resizeStartX = 0;
        let resizeStartY = 0;
        let resizeStartWidth = 0;
        let resizeStartHeight = 0;
        let resizeDirection = null;
        let showAuthorInfo = true;
        let showRecentPosts = true;

        let selectedCardIndex = null;

        const API_ROOT = 'http://127.0.0.1:8000/api/admin';
        const accessToken = localStorage.getItem('access_token');
        // const adminUUID = localStorage.getItem('admin_uuid');

        function getAuthHeaders() {
        return {
            'Authorization': `Bearer ${accessToken}`,
            'Content-Type': 'application/json'
        };
        }

        async function authFetch(url, options = {}) {
        const res = await fetch(`${API_ROOT}${url}`, {
            ...options,
            headers: getAuthHeaders()
        });

        if (res.status === 401) {
            alert("Session expired. Please log in again.");
            window.location.href = 'login.html';
            return;
        }
        return res.json();
        }

        async function authFileFetch(url, formData) {
            const res = await fetch(`${API_ROOT}${url}`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                },
                body: formData
            });

            if (!res.ok) {
                const error = await res.json();
                throw new Error(error.message || 'File upload failed');
            }
            return await res.json();
        }

        async function uploadFile(url, file, prompt, doc_index) {
            const formData = new FormData();
            console.log(file);
            formData.append("file", file);
            formData.append("prompt", prompt);
            formData.append("doc_index", doc_index);
            formData.forEach((value, key) => {
                console.log(key, value);
                });
            // displayloadingDocuments(doc_index)
            const res = await authFileFetch(url,formData);
            console.log(res)
            // if (!res.ok) {
            //     const error = await res;
            //     throw new Error(error.message || 'Request failed');
            // }
            
            return await res;
        }

        function displayloadingDocuments(index) {
            // Hide the two upload boxes
            const cols = document.querySelectorAll('.col-12.col-md-4');
            if (cols[0]) cols[0].style.display = 'none';
            if (cols[1]) cols[1].style.display = 'none';

            // Find container
            const container = document.querySelectorAll('.row.g-3')[1];
            if (!container) return;

            container.innerHTML = '';
            let currentLang = localStorage.getItem('language') || 'fa'
            const loadingHTML = `
        <div class="loading-card col-12 text-center">
            <h4 class="loading-title" >${currentLang === "fa" ?' ÿØÿ± ÿ≠ÿßŸÑ ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å ŸÖÿØÿßÿ±⁄© ...' : 'Uploading documents‚Ä¶'}</h4>
            <p class="loading-text">${currentLang === "fa" ?'ŸÑÿ∑ŸÅÿß ŸÖŸÜÿ™ÿ∏ÿ± ÿ®ŸÖÿßŸÜ€åÿØ ÿ™ÿß ŸÅÿß€åŸÑ‚ÄåŸáÿß€å ÿ¥ŸÖÿß Ÿæÿ±ÿØÿßÿ≤ÿ¥ ÿ¥ŸàŸÜÿØ' : 'Please wait while your files are being processed.'}</p>

            <div class="progress-wrapper">
                <div class="progress-bar-slide"></div>
            </div>
        </div>
    `;

            container.insertAdjacentHTML('beforeend', loadingHTML);
        }
        function updateLanguage(lang) {
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'fa' ? 'rtl' : 'ltr';
            
            // Update navbar direction
            // const navbar = document.querySelector('.navbar');
            // if (navbar) {
            //     navbar.style.direction = lang === 'fa' ? 'rtl' : 'ltr';
            // }

            // Update all elements with data-label attribute
            document.querySelectorAll('[data-label]').forEach(element => {
                const label = element.getAttribute('data-label');
                if (translations[lang][label]) {
                    element.textContent = translations[lang][label];
                }
            });

            // Update placeholders
            const placeholder = lang === 'fa' ? '"ÿπŸÜŸàÿßŸÜ ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ..."' : '"Enter heading..."';
            document.body.style.setProperty('--heading-placeholder', placeholder);
            const contentPlaceholder = lang === 'fa' ? '"ŸÜŸàÿ¥ÿ™ŸÜ ÿ±ÿß ÿ¥ÿ±Ÿàÿπ ⁄©ŸÜ€åÿØ..."' : '"Start writing..."';
            document.body.style.setProperty('--content-placeholder', contentPlaceholder); 
            const mediaPlaceholder = lang === 'fa' ? '"ÿØÿ±ÿ≠ÿßŸÑ ÿ™ŸàŸÑ€åÿØ ÿ±ÿ≥ÿßŸÜŸá"' : '"Generating media in progress"';
            document.body.style.setProperty('--media-placeholder', mediaPlaceholder);
            // const headingPlaceholder = lang === 'fa' ? 'ÿπŸÜŸàÿßŸÜ ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ...' : 'Enter heading...';
            // const contentPlaceholder = lang === 'fa' ? 'ŸÜŸàÿ¥ÿ™ŸÜ ÿ±ÿß ÿ¥ÿ±Ÿàÿπ ⁄©ŸÜ€åÿØ...' : 'Start writing...';
            
            // Re-render to apply placeholders
            renderCards();
        }

        function setTheme(theme) {
            document.body.dataset.theme = theme;
            localStorage.setItem('theme', theme);
            saveToJSON()
        }

		const params = new URLSearchParams(window.location.search);
		const blogTitle = params.get('title');
		
		async function loadBlogDetails() {
		  if (!blogTitle) return;
		
		  const blog = await authFetch(`/blogs/${blogTitle}`);
          return blog
		}
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // loadFromLocalStorage();
            setupEventListeners();
            setupKeyboardShortcuts();
            currentLanguage = 'fa';
            console.log(currentLanguage);
            updateLanguage(currentLanguage);
            console.log(cards.length)
            
            // Load sample data if no cards exist
            // if (cards.length === 3) {
            loadSampleData();
            // }
        });
        async function fetchAdminInfo() {
            try {
                admin = await authFetch(`/admin/profile/`, {
                        method: 'GET',
                    });
                return admin;
            }
            catch (error) {
                console.error('Error loading admin info:', error);
                throw error;
            }
        }
        // Sample Data
        async  function loadSampleData() {
            // const sampleData = [
            //     {
            //         heading: "Create Relevant Content",
            //         content: "You'll be posting loads of engaging content, so be sure to keep your blog organized with Categories that also allow readers to explore more of what interests them. Each category of your blog has its own page that's fully customizable. Add a catchy title, a brief description and a beautiful image to the category page header to truly make it your own."
            //     },
            //     {
            //         heading: "Use Hashtags Effectively",
            //         content: "You can also add tags (#vacation #dream #summer) throughout your posts to reach more people, and help readers search for relevant content. Using hashtags can expand your post reach and help people find the content that matters to them. Go ahead, #hashtag away."
            //     },
            //     {
            //         heading: "Share Your Story",
            //         content: "Every blog post is an opportunity to connect with your audience. Share your experiences, insights, and lessons learned. Be authentic and let your personality shine through your writing."
            //     }
            // ];
            const blog = await  loadBlogDetails()
            if (!blog || !blog.content) {
                console.error("No blog data found");
                return;
            }
            console.log(blog)
            document.body.dataset.theme = blog.settings.theme;

            currentLanguage = blog.settings.language; 
            const html = document.documentElement;
            const btn = document.getElementById('langBtn');
            if (currentLanguage === 'fa') {
                    html.setAttribute('dir', 'rtl');
                    html.setAttribute('lang', 'fa');
                    btn.textContent = 'üåê FA';
            } else {
                html.setAttribute('dir', 'ltr');
                html.setAttribute('lang', 'en');
                btn.textContent = 'üåê EN';
            }
            
            
            const savedWidth = blog.settings.containerWidth
            const widthSlider = document.getElementById('widthSlider');
            const widthValue = document.getElementById('widthValue');
            if (savedWidth) {
                document.documentElement.style.setProperty('--container-width', savedWidth );
                widthSlider.value = savedWidth;
                widthValue.textContent = savedWidth ;
            }
            
            
            let admin = JSON.parse(localStorage.getItem('adminInfo'));
            // const userNameSpan = document.querySelector('#userDropdown span');
            const authorInfo = document.querySelector('#authorInfo');

            // If not found, fetch from backend
            if (!admin) {
                console.log("Fetching admin info from backend...");
                admin = await fetchAdminInfo();
                // Save to localStorage
                const profile = admin[0];
                console.log('Profile data:', profile);
                localStorage.setItem('adminInfo', JSON.stringify(profile));
                // userNameSpan.textContent = `${profile.user.first_name} ${profile.user.last_name}`;
                updateAuthorInfo(profile);
            } else {
                console.log("Loaded admin info from localStorage:", admin);
                // userNameSpan.textContent = `${admin.user.first_name} ${admin.user.last_name}`;
                updateAuthorInfo(admin);
            }

            // Function to update author information
            function updateAuthorInfo(admin) {
                // Update author name
                const authorName = document.querySelector('.author-name');
                authorName.textContent = `${admin.user.username}`;
                
                // Update author bio (or use email if bio not available)
                const authorBio = document.querySelector('.author-bio');
                authorBio.textContent = admin.user.email || 'Content creator';
                
                // Update author avatar (using first letter of first name and last name)
                const authorAvatar = document.querySelector('.author-avatar');
                const initials = `${admin.user.first_name.charAt(0)}${admin.user.last_name.charAt(0)}`;
                authorAvatar.textContent = initials;
                
                // Optional: Update author links if you have social media data
                const authorLinks = document.querySelector('.author-links');
                // If your admin object has social links, update them:
                // authorLinks.innerHTML = `
                //     <a href="${admin.website}" class="author-link">Website</a>
                //     <a href="${admin.twitter}" class="author-link">Twitter</a>
                //     <a href="${admin.linkedin}" class="author-link">LinkedIn</a>
                // `;
            }
            // Convert backend blog content into your card structure
            cards = blog.content.map(section =>
                createCard({
                    heading: section.heading,
                    content: section.body,
                    mediaType: section.media?.type || null,
                    image: section.media?.url || null,
                    imagePosition: section.media?.Position?.toLowerCase() || 'top',
                    imageWidth: Number(section.media?.Width) || null,
                    imageHeight: Number(section.media?.Height) || null,
                    media_task_id:section.media?.media_task_id || '',
                    prompt : section.media?.prompt || '',
                })
            );
            
            // cards = sampleData.map(data => createCard(data));
            
            renderCards();
            await generate_first_media()
            
            // saveToJSON();
        }

        

        // Card Management
        // function createCard(data = {}) {
        //     return {
        //         id: Date.now() + Math.random(),
        //         heading: data.heading || '',
        //         content: data.content || '',
        //         image: data.image || null,
        //         imagePosition: data.imagePosition || 'top',
        //         imageWidth: data.imageWidth || null,
        //         imageHeight: data.imageHeight || null
        //     };
        // }
        function createCard(data = {}) {
            return {
                id: Date.now() + Math.random(),
                heading: data.heading || '',
                content: data.content || '',
                image: data.image || null,
                mediaType: data.mediaType || 'image', // ‚≠ê NEW
                imagePosition: data.imagePosition || 'top',
                imageWidth: data.imageWidth || null,
                imageHeight: data.imageHeight || null,
                media_task_id: data.media_task_id || '',
                prompt : data.prompt || '',
            };
        }
        async function  saveToJSON() {
            const blogData = {
                content: cards.map(card => ({
                    heading: card.heading || "",
                    body: card.content || "",
                    media: {
                        type: card.mediaType || "image",
                        // prompt: card.prompt || "None",
                        url: card.image || null,
                        Position: (card.imagePosition || "top").toLowerCase(),
                        Width: card.imageWidth ? Number(card.imageWidth) : null,
                        Height: card.imageHeight ? Number(card.imageHeight) : null,
                        media_task_id: card.media_task_id || '',
                        prompt: card.prompt || ''
                    }
                })),
                settings: {
                    theme: document.body.dataset.theme || 'light',
                    containerWidth: document.documentElement.style.getPropertyValue('--container-width') || '1100px',
                    language: currentLanguage
                },
                image_url : cards[0].image,
            };
            // console.log(blogData);
            const blogTitle = params.get('title');
            response = await authFetch(`/blogs/${blogTitle}/` ,{
                    method: 'PATCH',
                    body: JSON.stringify(blogData)
                });
            console.log('blog updated', response)
            localStorage.setItem('blogData', JSON.stringify(blogData));
        }
        function renderCards() {
            const container = document.getElementById('cardsContainer');
            container.innerHTML = '';
            let card_index = null;
            cards.forEach((card, index) => {
                if (index > 0 || cards.length === 0) {
                    const divider = createCardDivider(index);
                    container.appendChild(divider);
                }
                if (card.prompt && !card.media_task_id && !card.image && card.mediaType){
                    card_index = index
                    card.media_task_id = "fake"   
                }
                const cardElement = createCardElement(card, index);
                container.appendChild(cardElement);
            });
            if(card_index != null){
                cards[card_index].media_task_id = ''
            }
            
            // Add divider after last card
            const finalDivider = createCardDivider(cards.length);
            container.appendChild(finalDivider);

            pollMediaTasks()
        }

        function createCardDivider(insertIndex) {
            const divider = document.createElement('div');
            divider.className = 'card-divider ';
            divider.innerHTML = `
                <div class="card-divider-line"></div>
                <div class="card-divider-buttons">
                    <button class="insert-card-button" onclick="insertCardAt(${insertIndex})" title="Insert card">+</button>
                </div>
            `;
            return divider;
        }

        async function generate_first_media() {
            for (let index = 0; index < cards.length; index++) {
                const card = cards[index];
                if (card.prompt && !card.media_task_id && !card.image && card.mediaType){
                    // let url;
                    // let body_input;
                    // if (card.mediaType === "image") {
                    //     url = "https://generate-media.onrender.com/gpt4o/generate";
                    //     body_input = JSON.stringify({
                    //         prompt: card.prompt,
                    //         size: "3:2",
                    //         nVariants: 1
                    //     })
                    // } else if (card.mediaType === "video") {
                    //     url = "https://generate-media.onrender.com/runway/generate";
                    //     body_input = JSON.stringify({
                    //         prompt: card.prompt,
                    //         duration:5,
                    //         quality :'720p',
                    //         aspectRatio:'16:9',
                    //         waterMark:''
                    //     })
                    // }

                    // console.log(card.mediaType)
                    // const res = await fetch( url, {
                    //     method: "POST",
                    //     headers: {
                    //         "Content-Type": "application/json"
                    //     },
                    //     body: body_input
                    //     // headers: getAuthHeaders()
                    // });
                    // const data = await res.json()
                    // console.log(data);
                    // card.media_task_id = data;
                    card.media_task_id = "bb35343c54c127bf5b0364644c8ff5c6"
                    saveToJSON();
                    renderCards();
                    // if (data.taskId) {
                    //     card.media_task_id = data.taskId;
                    //     saveToJSON();
                    // }
                }
                
            }
        }

        function createCardElement(card, index) {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'card mb-5';
            cardDiv.dataset.index = index;
            
            const topBar = document.createElement('div');
            topBar.className = 'card-top-bar';
            topBar.innerHTML = `
                <div class="card-actions">
                    <div class="card-action-btn drag-handle" draggable="true" title="Drag to reorder">‚ãÆ‚ãÆ</div>
                    <button class="card-action-btn" onclick="addImageToCard(${index})" title="Import Media">
                        <?xml version="1.0" encoding="utf-8"?><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="15px" height="15px" viewBox="0 0 122.88 122.151" enable-background="new 0 0 122.88 122.151" xml:space="preserve"><g><path d="M8.676,0h105.529c2.405,0,4.557,0.984,6.124,2.552c1.567,1.567,2.551,3.754,2.551,6.124v104.8 c0,2.405-0.983,4.557-2.551,6.124c-1.568,1.567-3.755,2.552-6.124,2.552H8.676c-2.406,0-4.557-0.984-6.124-2.553 C0.984,118.032,0,115.845,0,113.476V8.675C0,6.27,0.984,4.119,2.552,2.552C4.12,0.984,6.307,0,8.676,0L8.676,0z M9.097,88.323 l35.411-33.9c1.421-1.313,3.645-1.167,4.921,0.255c0.037,0.036,0.037,0.073,0.073,0.073l31.459,37.218l4.812-29.6 c0.328-1.896,2.114-3.208,4.01-2.879c0.729,0.109,1.385,0.474,1.895,0.948l22.07,23.184V10.773c0-0.474-0.183-0.875-0.511-1.166 c-0.291-0.292-0.729-0.511-1.166-0.511H10.737c-0.474,0-0.875,0.182-1.166,0.511c-0.292,0.291-0.511,0.729-0.511,1.166v77.55H9.097 L9.097,88.323z M90.526,19.866c3.464,0,6.635,1.422,8.895,3.682c2.297,2.296,3.682,5.431,3.682,8.895 c0,3.463-1.421,6.634-3.682,8.894c-2.296,2.297-5.431,3.682-8.895,3.682c-3.462,0-6.634-1.421-8.894-3.682 c-2.297-2.296-3.682-5.431-3.682-8.894c0-3.463,1.421-6.634,3.682-8.895C83.929,21.251,87.064,19.866,90.526,19.866L90.526,19.866z"/></g></svg>
                        </button>
                    <button class="card-action-btn" onclick="generateImageToCard(${index})" title="Generate Media" >
                        <svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width: 19px;"><g clip-path="url(#prefix__clip0_5_13)" fill-rule="evenodd" clip-rule="evenodd" fill="#000"><path d="M211.648 89.515h-76.651A57.707 57.707 0 0077.291 147.2v242.389a57.707 57.707 0 0057.706 57.707h242.411a57.707 57.707 0 0057.707-57.707V288.128l34.624-23.744v125.227a92.35 92.35 0 01-92.331 92.33H134.997a92.349 92.349 0 01-92.33-92.33v-242.39A92.336 92.336 0 0169.702 81.92a92.33 92.33 0 0165.295-27.05h96.96l-20.309 34.645z"/><path d="M380.16 0c3.093 0 5.717 2.219 6.379 5.248a149.328 149.328 0 0040.533 74.325 149.332 149.332 0 0074.347 40.555c3.029.661 5.248 3.285 5.248 6.4a6.574 6.574 0 01-5.248 6.357 149.338 149.338 0 00-74.326 40.555 149.338 149.338 0 00-40.789 75.413 6.334 6.334 0 01-6.144 5.078 6.334 6.334 0 01-6.144-5.078 149.338 149.338 0 00-40.789-75.413 149.326 149.326 0 00-75.414-40.789 6.338 6.338 0 01-5.077-6.144c0-2.987 2.133-5.547 5.077-6.144a149.336 149.336 0 0075.414-40.79 149.354 149.354 0 0040.554-74.325A6.573 6.573 0 01380.16 0z"/></g><defs><clipPath id="prefix__clip0_5_13"><path fill="#fff" d="M0 0h512v512H0z"/></clipPath></defs></svg>
                        </button>
                </div>
                <div class="card-menu-wrapper">
                    <button class="card-menu-button" onclick="toggleCardMenu(${index})" title="Card options">‚ãÆ</button>
                    <div class="card-menu" id="cardMenu${index}">
                        <button class="card-menu-item" onclick="duplicateCard(${index})">üìã ${currentLanguage === 'fa' ? 'ÿ™⁄©ÿ´€åÿ±' : 'Duplicate'}</button>
                        <button class="card-menu-item danger" onclick="deleteCard(${index})">üóëÔ∏è ${currentLanguage === 'fa' ? 'ÿ≠ÿ∞ŸÅ' : 'Delete'}</button>
                    </div>
                </div>
            `;
            cardDiv.appendChild(topBar);
            
            const header = document.createElement('div');
            header.className = 'card-header_';
            
            const heading = document.createElement('div');
            heading.className = 'card-heading';
            heading.contentEditable = !isPreviewMode;
            // heading.textContent = card.heading;
            heading.innerHTML = card.heading;
            heading.addEventListener('blur', () => {
                // card.heading = heading.textContent;
                card.heading = heading.innerHTML;
                saveToJSON();
            });
            
            header.appendChild(heading);
            
            const contentWrapper = document.createElement('div');
            if (card.imagePosition == "top" || card.imagePosition == "bottom") {
                contentWrapper.className = `card-content-wrapper`;
            } else {
                contentWrapper.className = `card-content-wrapper image-${card.imagePosition}`;  
            }

            const content = document.createElement('div');
            content.className = 'card-content';
            content.contentEditable = !isPreviewMode;
            content.innerHTML = card.content;
            content.addEventListener('blur', () => {
                card.content = content.innerHTML;
                saveToJSON();
            });
            
            contentWrapper.appendChild(content);
            
            if (card.image && !isPreviewMode) {
                const imageControls = document.createElement('div');
                imageControls.className = 'image-controls';
                imageControls.innerHTML = `
                    <div class="image-controls-label">${currentLanguage === 'fa' ? 'ŸÖŸàŸÇÿπ€åÿ™ ÿ™ÿµŸà€åÿ±' : 'Image Position'}</div>
                    <div class="image-position-buttons">
                        <button class="image-position-btn ${card.imagePosition === 'top' ? 'active' : ''}" onclick="changeImagePosition(${index}, 'top')">${currentLanguage === 'fa' ? 'ÿ®ÿßŸÑÿß' : 'Top'}</button>
                        <button class="image-position-btn ${card.imagePosition === 'bottom' ? 'active' : ''}" onclick="changeImagePosition(${index}, 'bottom')">${currentLanguage === 'fa' ? 'Ÿæÿß€å€åŸÜ' : 'Bottom'}</button>
                        <button class="image-position-btn ${card.imagePosition === 'right' ? 'active' : ''}" onclick="changeImagePosition(${index}, 'right')">${currentLanguage === 'fa' ?  'ÿ±ÿßÿ≥ÿ™': 'Left'}</button>
                        <button class="image-position-btn ${card.imagePosition === 'left' ? 'active' : ''}" onclick="changeImagePosition(${index}, 'left')">${currentLanguage === 'fa' ? '⁄ÜŸæ' : 'Right'}</button>
                    </div>
                `;
                const imageContainer = createImageContainer(card, index);
                // const imageContainer = createMediaContainer(card, index);

                if (card.imagePosition == "top") {
                    cardDiv.appendChild(header);
                    cardDiv.appendChild(imageContainer);
                    cardDiv.appendChild(contentWrapper);
                } else if (card.imagePosition == "bottom") {
                    cardDiv.appendChild(header); 
                    cardDiv.appendChild(contentWrapper); 
                    cardDiv.appendChild(imageContainer);
                } else {
                    cardDiv.appendChild(header);
                    contentWrapper.appendChild(imageContainer);
                    cardDiv.appendChild(contentWrapper); 
                }
                cardDiv.appendChild(imageControls);
            } else {
                if (card.image) {
                    const imageContainer = createImageContainer(card, index);
                    //  const imageContainer = createMediaContainer(card, index);
                    if (card.imagePosition == "top") {
                        cardDiv.appendChild(header);
                        cardDiv.appendChild(imageContainer);
                        cardDiv.appendChild(contentWrapper);
                    } else if (card.imagePosition == "bottom") {
                        cardDiv.appendChild(header); 
                        cardDiv.appendChild(contentWrapper); 
                        cardDiv.appendChild(imageContainer);
                    } else {
                        cardDiv.appendChild(header);
                        contentWrapper.appendChild(imageContainer);
                        cardDiv.appendChild(contentWrapper); 
                    }
                } else {
                    if(card.media_task_id){
                        const imageContainer = generating_media(card.media_task_id)

                        cardDiv.appendChild(header);
                        cardDiv.appendChild(imageContainer);
                        cardDiv.appendChild(contentWrapper);
                    }
                    else{
                        cardDiv.appendChild(header);
                        cardDiv.appendChild(contentWrapper);
                    }
                    
                }
            }
            
            const dragHandle = topBar.querySelector('.drag-handle');
            dragHandle.addEventListener('mousedown', () => {
                cardDiv.draggable = true;
            });
            
            cardDiv.addEventListener('dragstart', handleDragStart);
            cardDiv.addEventListener('dragover', handleDragOver);
            cardDiv.addEventListener('drop', handleDrop);
            cardDiv.addEventListener('dragend', handleDragEnd);
            
            return cardDiv;
        }
        function generating_media(task_id){
            const imageContainer = document.createElement('div');
            imageContainer.className = 'card-image-container';
            imageContainer.innerHTML = `
            
            <div class="col-12 mb-3">
                <div class="card doc-card hover-card-light border-0">
                    <div class="text-decoration-none">
                        <span class="placeholder col-12 d-flex flex-column justify-content-center align-items-center"
                            style="height: 270px; border-radius: 0.35rem; font-weight: 500; font-size: 1.1rem; gap: 5px;">
                            <div class="spinner-border" role="status" style="width: 2rem; height: 2rem;color: aliceblue;">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="media-placholder mb-0" style="font-weight: 500; font-size: 1.1rem; color:#ffffff"></p>
                            <p id="${task_id}"style="font-weight: 500; font-size: 1.1rem; color:#ffffff">0%</p>
                        </span>
                    </div>
                </div>
            </div>
            `;
            return imageContainer;
        }
        function pollMediaTasks() {
            // Loop through each card
            const blogTitle = params.get('title');
            cards.forEach((card, index) => {
                if (card.media_task_id && card.media_task_id.trim() !== "") {
                    startPolling(card.media_task_id, blogTitle, card.mediaType || "image", index);
                }
            });
        }

        // Polling function for one task_id
        function startPolling(taskId, blogTitle, mediaType, index) {

            async function checkStatus() {
                try {
                    // const res = await authFetch(`/blogs/${blogTitle}/media_stream_2/`, {
                    //     method: "POST",
                    //     body: JSON.stringify({
                    //         task_id: taskId,
                    //         media_type: mediaType,
                    //     }),
                    // });
                    let url ;
                    if (mediaType === "image") {
                        url = `https://generate-media.onrender.com/gpt4o/status?taskId=${taskId}`;
                    } else if (mediaType === "video") {
                        // url = `https://generate-media.onrender.com/runway/status?taskId=${taskId}`;
                        
                        url = `https://generate-media.onrender.com/gpt4o/status?taskId=${taskId}`;
                    }
                    const res = await fetch(url, {
                        method: "GET",
                    });
                    const data = await res.json() ;
                    console.log(data)
                    // Update progress text
                    const progressEl = document.getElementById(taskId);
                    // --- Handle states ----

                    if (mediaType === "image") {
                        if (data.successFlag === 0) {
                            if (progressEl) {
                                if (data.progress !== undefined) {
                                    progressEl.innerText = `${data.progress}%`;
                                }
                            }
                            // keep polling
                            setTimeout(checkStatus, 5000);
                        }

                        else if (data.successFlag === 1) {
                            // Replace placeholder with generated image
                            const placeholder = progressEl?.closest(".card-image-container");
                            if (placeholder) {
                                cards[index].image = data.response.resultUrls[0]
                                cards[index].media_task_id = ''
                                renderCards();
                                saveToJSON();
                                return;
                                // placeholder.innerHTML = `
                                //     <img src="${data.url}" class="img-fluid rounded" alt="generated media">
                                // `;
                            }
                        }

                        else {
                            if (progressEl) {
                                progressEl.innerText = "Failed";
                            }
                        }
                    }
                    else if (mediaType === "video") {
                        alert(data.state)
                        if(data.state === "success"){
                            cards[index].image = data.videoInfo.videoUrl
                                cards[index].media_task_id = ''
                                renderCards();
                                saveToJSON();
                                return;
                        }
                        else if (data.state === "fail"){
                            progressEl.innerText = "Failed";
                        }
                        else{
                            progressEl.innerText = "";
                        }
                    }
                } catch (err) {
                    console.error("Error checking media:", err);
                    setTimeout(checkStatus, 10000); // retry
                }
            }

            // First call
            checkStatus();
        }
        function createImageContainer(card, index) {
            // console.log(card);
            const imageContainer = document.createElement('div');
            imageContainer.className = 'card-image-container';
            imageContainer.dataset.cardIndex = index;

            // Apply saved dimensions if they exist
            if (card.imageWidth) {
                imageContainer.style.width = card.imageWidth + 'px';
            }
            if (card.imageHeight) {
                imageContainer.style.height = card.imageHeight + 'px';
            }

            let mediaElement;

            // ---- NEW: support image or video ----
            if (card.mediaType === 'video') {
                mediaElement = document.createElement('video');
                mediaElement.className = 'card-image';
                mediaElement.src = card.image;
                mediaElement.controls = true;
            } else {
                mediaElement = document.createElement('img');
                mediaElement.className = 'card-image';
                mediaElement.src = card.image;
                mediaElement.alt = card.heading;
            }
            // -------------------------------------

            const removeBtn = document.createElement('button');
            removeBtn.className = 'image-remove-btn';
            removeBtn.innerHTML = '‚úï';
            removeBtn.onclick = () => removeImage(index);

            const resizeHandleE = document.createElement('div');
            resizeHandleE.className = 'resize-handle resize-handle-e';
            resizeHandleE.dataset.direction = 'e';

            const resizeHandleS = document.createElement('div');
            resizeHandleS.className = 'resize-handle resize-handle-s';
            resizeHandleS.dataset.direction = 's';

            const resizeHandleSE = document.createElement('div');
            resizeHandleSE.className = 'resize-handle resize-handle-se';
            resizeHandleSE.dataset.direction = 'se';

            // Add resize event listeners
            [resizeHandleE, resizeHandleS, resizeHandleSE].forEach(handle => {
                handle.addEventListener('mousedown', startResize);
            });

            imageContainer.appendChild(mediaElement);
            imageContainer.appendChild(removeBtn);
            imageContainer.appendChild(resizeHandleE);
            imageContainer.appendChild(resizeHandleS);
            imageContainer.appendChild(resizeHandleSE);

            return imageContainer;
        }


        // function createImageContainer(card, index) {
        //     const imageContainer = document.createElement('div');
        //     imageContainer.className = 'card-image-container';
        //     imageContainer.dataset.cardIndex = index;
            
        //     // Apply saved dimensions if they exist
        //     if (card.imageWidth) {
        //         imageContainer.style.width = card.imageWidth + 'px';
        //     }
        //     if (card.imageHeight) {
        //         imageContainer.style.height = card.imageHeight + 'px';
        //     }
            
        //     const img = document.createElement('img');
        //     img.className = 'card-image';
        //     img.src = card.image;
        //     img.alt = card.heading;
            
        //     const removeBtn = document.createElement('button');
        //     removeBtn.className = 'image-remove-btn';
        //     removeBtn.innerHTML = '‚úï';
        //     removeBtn.onclick = () => removeImage(index);
            
        //     const resizeHandleE = document.createElement('div');
        //     resizeHandleE.className = 'resize-handle resize-handle-e';
        //     resizeHandleE.dataset.direction = 'e';
            
        //     const resizeHandleS = document.createElement('div');
        //     resizeHandleS.className = 'resize-handle resize-handle-s';
        //     resizeHandleS.dataset.direction = 's';
            
        //     const resizeHandleSE = document.createElement('div');
        //     resizeHandleSE.className = 'resize-handle resize-handle-se';
        //     resizeHandleSE.dataset.direction = 'se';
            
        //     // Add resize event listeners
        //     [resizeHandleE, resizeHandleS, resizeHandleSE].forEach(handle => {
        //         handle.addEventListener('mousedown', startResize);
        //     });
            
        //     imageContainer.appendChild(img);
        //     imageContainer.appendChild(removeBtn);
        //     imageContainer.appendChild(resizeHandleE);
        //     imageContainer.appendChild(resizeHandleS);
        //     imageContainer.appendChild(resizeHandleSE);
            
        //     return imageContainer;
        // }
        


        function startResize(e) {
            e.preventDefault();
            e.stopPropagation();
            
            resizingImage = e.target.parentElement;
            resizeDirection = e.target.dataset.direction;
            resizeStartX = e.clientX;
            resizeStartY = e.clientY;
            resizeStartWidth = resizingImage.offsetWidth;
            resizeStartHeight = resizingImage.offsetHeight;
            
            document.addEventListener('mousemove', doResize);
            document.addEventListener('mouseup', stopResize);
        }
          
        function doResize(e) {
            if (!resizingImage) return;
            
            const deltaX = e.clientX - resizeStartX;
            const deltaY = e.clientY - resizeStartY;
            
            if (resizeDirection === 'e') {
                const newWidth = Math.max(100, resizeStartWidth + deltaX);
                resizingImage.style.width = newWidth + 'px';
            } else if (resizeDirection === 's') {
                const newHeight = Math.max(100, resizeStartHeight + deltaY);
                resizingImage.style.height = newHeight + 'px';
            } else if (resizeDirection === 'se') {
                const newWidth = Math.max(100, resizeStartWidth + deltaX);
                const newHeight = Math.max(100, resizeStartHeight + deltaY);
                resizingImage.style.width = newWidth + 'px';
                resizingImage.style.height = newHeight + 'px';
            }
        }

        function stopResize() {
            if (resizingImage) {
                const cardIndex = parseInt(resizingImage.dataset.cardIndex);
                cards[cardIndex].imageWidth = resizingImage.offsetWidth;
                cards[cardIndex].imageHeight = resizingImage.offsetHeight;
                // saveToLocalStorage();
                saveToJSON();
            }
            
            resizingImage = null;
            document.removeEventListener('mousemove', doResize);
            document.removeEventListener('mouseup', stopResize);
        }


        function insertCardAt(index) {
            const newCard = createCard();
            cards.splice(index, 0, newCard);
            renderCards();
            saveToJSON();
            // saveToLocalStorage();
        }

        function toggleCardMenu(index) {
            const menu = document.getElementById(`cardMenu${index}`);
            const allMenus = document.querySelectorAll('.card-menu');
            
            allMenus.forEach(m => {
                if (m !== menu) m.classList.remove('active');
            });
            
            menu.classList.toggle('active');
        }

        // Close menus when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.card-menu-wrapper')) {
                document.querySelectorAll('.card-menu').forEach(m => {
                    m.classList.remove('active');
                });
            }
        });

        // Image Management
        function addImageToCard(index,prompt='None') {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*,video/*';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                // Optionally check file size (e.g., 10MB max)
                const maxSize = 10 * 1024 * 1024; // 10 MB
                if (file.size > maxSize) {
                    alert("File is too large! Max size is 10MB.");
                    return;
                }

               const reader = new FileReader();
                reader.onload = async (event) => {
                    try {
                        // Update preview locally
                        cards[index].image = 'https://cdn.dribbble.com/userupload/20824996/file/original-60b690c00364623636a316402e9d00c8.gif' //event.target.result;
                        renderCards();
                        const blogTitle = params.get('title');
                        // Use your uploadFile function
                        const response = await uploadFile(`/blogs/${blogTitle}/upload_media/`, file, prompt , index);
                        console.log('Upload successful:', response);
                        cards[index].mediaType = file.type.startsWith("video") ? "video" : "image";
                        cards[index].image = response.url 
                        renderCards();
                        // Save changes to JSON
                        saveToJSON();
                    } catch (err) {
                        console.error(err);
                        cards[index].image = ''
                        renderCards();
                        alert("Failed to upload file.");
                        
                    }
                };
                reader.readAsDataURL(file);
            };
            input.click();
        }

        function generateImageToCard(index){
            selectedCardIndex = index;
            document.getElementById('mediaGeneratorBox').style.display = 'block';
                
        }
        // Close box
        function closeMediaBox() {
            document.getElementById('mediaGeneratorBox').style.display = 'none';
            document.getElementById('mediaPrompt').value = "";
            document.getElementById('mediaResult').innerHTML = "";
        }
        function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
        }
        async function sendMediaRequest() {
            const mediaType = document.getElementById('mediaType').value;
            const prompt = document.getElementById('mediaPrompt').value;
            let media_status = null;

            if (!prompt.trim()) {
                alert("Please enter a prompt.");
                return;
            }
            document.getElementById('mediaResult').innerHTML = "ÿØÿ±ÿ≠ÿßŸÑ ÿ™ŸàŸÑ€åÿØ ...";

            try {
                // const res = await fetch("/api/generate-media/", {
                //     method: "POST",
                //     headers: {"Content-Type": "application/json"},
                //     body: JSON.stringify({
                //         index: selectedCardIndex,
                //         media_type: mediaType,
                //         prompt: prompt
                //     })
                // });
                const blogTitle = params.get('title');
                // const res = await authFetch(`/blogs/${blogTitle}/generate_media/` , {
                //     method: "POST",
                //     body:JSON.stringify({
                //         prompt: prompt,
                //         section_index: String(selectedCardIndex),
                //         media_type: mediaType,
                //     })
                // });
                
                // if (media_type == "image"){
                    
                // }
                // else{
                //     const res = await fetch(``, {
                //         method: "POST",
                //         body:JSON.stringify({
                //             prompt: prompt,
                //             size : "3:2",
                //             nVariants:1
                //         })
                //         // headers: getAuthHeaders()
                //     });
                //     const data = await res
                // }
                let url;
                let body_input;
                if (mediaType === "image") {
                    url = "https://generate-media.onrender.com/gpt4o/generate";
                    body_input = JSON.stringify({
                        prompt: prompt,
                        size: "3:2",
                        nVariants: 1
                    })
                } else if (mediaType === "video") {
                    url = "https://generate-media.onrender.com/runway/generate";
                    body_input = JSON.stringify({
                        prompt: prompt,
                        duration:5,
                        quality :'720p',
                        aspectRatio:'16:9',
                        waterMark:''
                    })
                }

                console.log(mediaType)
                const res = await fetch( url, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: body_input
                    // headers: getAuthHeaders()
                });
                const data = await res.json()
                console.log(data);
                if (data.taskId) {
                    cards[selectedCardIndex].media_task_id = data.taskId //'https://cdn.dribbble.com/userupload/20824996/file/original-60b690c00364623636a316402e9d00c8.gif';
                    saveToJSON();
                    renderCards();
                    // const url = `${API_ROOT}/blogs/${blogTitle}/media_stream/?task_id=123&media_type=${mediaType}`;
                    // const eventSource = new EventSource(url);
                    // console.log("SSE connected:", url);
                    // while (true) {
                    //     const res = await authFetch(`/blogs/${blogTitle}/media_stream_2/` , {
                    //         method: "POST",
                    //         body:JSON.stringify({
                    //             task_id: data.task_id,
                    //             media_type: mediaType,
                    //         })
                    //     });
                    //     console.log(res)
                    //     if (res.status === 'completed'){
                    //         document.getElementById('mediaResult').innerText = `${res.url}`;
                    //         cards[selectedCardIndex].image = res.url
                    //         renderCards();
                    //         return
                    //     }
                    //     else if(res.status === 'progress'){
                    //         document.getElementById('mediaResult').innerText = `${res.progress}% ÿ™ŸàŸÑ€åÿØ ÿ¥ÿØŸá`;
                    //     }
                    //     else{
                    //         document.getElementById('mediaResult').innerText = "Error generating media.";
                    //         cards[selectedCardIndex].image = ''
                    //         renderCards();
                    //         return
                    //     }
                    //     await sleep(10000);
                    // }
                
                    document.getElementById('mediaResult').innerText = ''
                } else {
                    document.getElementById('mediaResult').innerText = "Error generating media.";
                }

            } catch (error) {
                document.getElementById('mediaResult').innerText = "Server error.";
            }
        }
        
        function removeImage(index) {
            cards[index].image = null;
            cards[index].imageWidth = null;
            cards[index].imageHeight = null;
            cards[index].prompt = null;
            renderCards();
            saveToJSON();
        }

        function changeImagePosition(index, position) {
            cards[index].imagePosition = position;
            renderCards();
            saveToJSON();
        }

        // Card Actions
        function duplicateCard(index) {
            const newCard = { ...cards[index], id: Date.now() + Math.random() };
            cards.splice(index + 1, 0, newCard);
            renderCards();
            saveToJSON();
        }

        function deleteCard(index) {
            const confirmText = currentLanguage === 'fa' ? 'ÿ¢€åÿß ŸÖÿ∑ŸÖÿ¶ŸÜ Ÿáÿ≥ÿ™€åÿØÿü' : 'Are you sure?';
            if (confirm(confirmText)) {
                cards.splice(index, 1);
                renderCards();
                saveToJSON();
            }
        }

        // Drag and Drop
        function handleDragStart(e) {
            draggedCard = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            
            const afterElement = getDragAfterElement(this.parentElement, e.clientY);
            if (afterElement == null) {
                this.classList.add('drag-over');
            }
            
            return false;
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            
            if (draggedCard !== this) {
                const draggedIndex = parseInt(draggedCard.dataset.index);
                const targetIndex = parseInt(this.dataset.index);
                
                const draggedItem = cards[draggedIndex];
                cards.splice(draggedIndex, 1);
                cards.splice(targetIndex, 0, draggedItem);
                
                renderCards();
                saveToJSON();
            }
            
            this.classList.remove('drag-over');
            return false;
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            this.draggable = false;
            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('drag-over');
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.card:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }
        
        // Toolbar Functions
        function setupEventListeners() {
            // document.getElementById('langBtn').addEventListener('click', () => {
            //     currentLanguage = currentLanguage === 'en' ? 'fa' : 'en';
            //     const btn = document.getElementById('langBtn');
            //     const html = document.documentElement;
                
            //     if (currentLanguage === 'fa') {
            //         html.setAttribute('dir', 'rtl');
            //         html.setAttribute('lang', 'fa');
            //         btn.textContent = 'üåê FA';
            //     } else {
            //         html.setAttribute('dir', 'ltr');
            //         html.setAttribute('lang', 'en');
            //         btn.textContent = 'üåê EN';
            //     }
                
            //     localStorage.setItem('language', currentLanguage);
            // });
            document.getElementById('langBtn').addEventListener('click', (e) => {
                e.preventDefault();
                currentLanguage = currentLanguage === 'fa' ? 'en' : 'fa';
                updateLanguage(currentLanguage);
                localStorage.setItem('language', currentLanguage);
            });

            const widthSlider = document.getElementById('widthSlider');
            const widthValue = document.getElementById('widthValue');
            
            widthSlider.addEventListener('input', (e) => {
                const width = e.target.value;
                document.documentElement.style.setProperty('--container-width', width + 'px');
                widthValue.textContent = width + 'px';
                saveToJSON()
                localStorage.setItem('containerWidth', width);
            });

            // Toolbar buttons
            // document.querySelectorAll('.toolbar-btn[data-command]').forEach(btn => {
            //     btn.addEventListener('click', () => {
            //         const command = btn.dataset.command;
            //         const value = btn.dataset.value || null;
            //         document.execCommand(command, false, value);
            //     });
            // });
            document.querySelectorAll('.toolbar-btn[data-command]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const command = btn.dataset.command;
                    const value = btn.dataset.value || null;
                    document.execCommand(command, false, value);
                    
                    setTimeout(() => {
                        const focusedElement = document.activeElement;
                        const focusedHeading = focusedElement.closest('.card-heading');
                        const focusedContent = focusedElement.closest('.card-content');
                        
                        if (focusedHeading || focusedContent) {
                            const cardIndex = focusedElement.closest('.card')?.dataset.index;
                            if (cardIndex !== undefined) {
                                if (focusedHeading) {
                                    cards[cardIndex].heading = focusedHeading.innerHTML;
                                }
                                if (focusedContent) {
                                    cards[cardIndex].content = focusedContent.innerHTML;
                                }
                                // saveToJSON();
                            }
                        }
                    }, 0);
                });
            });

           



            // Font family
            // document.getElementById('fontFamily').addEventListener('change', (e) => {
            //     document.execCommand('fontName', false, e.target.value);
            //     saveToJSON();
            // });
            document.getElementById('fontFamily').addEventListener('change', (e) => {
                document.execCommand('fontName', false, e.target.value);
                
                setTimeout(() => {
                    const focusedElement = document.activeElement;
                    const focusedHeading = focusedElement.closest('.card-heading');
                    const focusedContent = focusedElement.closest('.card-content');
                    
                    if (focusedHeading || focusedContent) {
                        const cardIndex = focusedElement.closest('.card')?.dataset.index;
                        if (cardIndex !== undefined) {
                            if (focusedHeading) {
                                cards[cardIndex].heading = focusedHeading.innerHTML;
                            }
                            if (focusedContent) {
                                cards[cardIndex].content = focusedContent.innerHTML;
                            }
                            //saveToJSON();
                        }
                    }
                    e.target.value = '';
                }, 0);
            });

            // const fontSizeSelect = document.getElementById('fontSize');
            // fontSizeSelect.addEventListener('change', (e) => {
            //     const size = e.target.value;
            //     if (size) {
            //         document.execCommand('fontSize', false, '7');
            //         const fontElements = document.querySelectorAll('font[size="7"]');
            //         fontElements.forEach(el => {
            //             el.removeAttribute('size');
            //             el.style.fontSize = size + 'px';
            //         });
            //     }
            //     // Reset select to placeholder
            //     e.target.value = '';
            // });
            const fontSizeSelect = document.getElementById('fontSize');
            fontSizeSelect.addEventListener('change', (e) => {
                const size = e.target.value;
                if (size) {
                    document.execCommand('fontSize', false, '7');
                    const fontElements = document.querySelectorAll('font[size="7"]');
                    fontElements.forEach(el => {
                        el.removeAttribute('size');
                        el.style.fontSize = size + 'px';
                    });
                    
                    setTimeout(() => {
                        const focusedElement = document.activeElement;
                        const focusedHeading = focusedElement.closest('.card-heading');
                        const focusedContent = focusedElement.closest('.card-content');
                        
                        if (focusedHeading || focusedContent) {
                            const cardIndex = focusedElement.closest('.card')?.dataset.index;
                            if (cardIndex !== undefined) {
                                if (focusedHeading) {
                                    cards[cardIndex].heading = focusedHeading.innerHTML;
                                }
                                if (focusedContent) {
                                    cards[cardIndex].content = focusedContent.innerHTML;
                                }
                                saveToJSON();
                            }
                        }
                        e.target.value = '';
                    }, 0);
                }
            });

            // Colors
            // document.getElementById('textColor').addEventListener('change', (e) => {
            //     document.execCommand('foreColor', false, e.target.value);
            // });

            // document.getElementById('bgColor').addEventListener('change', (e) => {
            //     document.execCommand('backColor', false, e.target.value);
            // });

            // Link button
            document.getElementById('linkBtn').addEventListener('click', () => {
                const url = prompt('Enter URL:');
                if (url) {
                    document.execCommand('createLink', false, url);
                }
            });

            // Theme selector
            // document.getElementById('themeSelector').addEventListener('change', (e) => {
            //     document.body.dataset.theme = e.target.value;
            //     localStorage.setItem('theme', e.target.value);
            // });

            // Preview button
            document.getElementById('previewBtn').addEventListener('click', togglePreview);

            // Export button
            // document.getElementById('exportBtn').addEventListener('click', () => {
            //     document.getElementById('exportModal').classList.add('active');
            // });

            // Load JSON button
            // document.getElementById('loadJsonBtn').addEventListener('click', () => {
            //     document.getElementById('loadJsonModal').classList.add('active');
            // });

            // Add card button
            // document.getElementById('addCardBtn').addEventListener('click', () => {
            //     cards.push(createCard());
            //     renderCards();
            //     saveToLocalStorage();
            // });

            // Modal buttons
            // document.getElementById('cancelExportBtn').addEventListener('click', () => {
            //     document.getElementById('exportModal').classList.remove('active');
            // });
            
            // document.getElementById('confirmExportBtn').addEventListener('click', exportContent);

            // document.getElementById('cancelLoadBtn').addEventListener('click', () => {
            //     document.getElementById('loadJsonModal').classList.remove('active');
            // });

            // document.getElementById('confirmLoadBtn').addEventListener('click', loadJsonData);

            // Publish button
            document.getElementById('publishBtn').addEventListener('click', publishBlog);

            // Load saved preferences
            // const savedTheme = localStorage.getItem('theme');
            // if (savedTheme) {
            //     document.body.dataset.theme = savedTheme;
            //     document.getElementById('themeSelector').value = savedTheme;
            // }
            
            
        }

        // Keyboard Shortcuts
        // function setupKeyboardShortcuts() {
        //     document.addEventListener('keydown', (e) => {
        //         if (e.ctrlKey || e.metaKey) {
        //             switch(e.key.toLowerCase()) {
        //                 case 'b':
        //                     e.preventDefault();
        //                     document.execCommand('bold');
        //                     break;
        //                 case 'i':
        //                     e.preventDefault();
        //                     document.execCommand('italic');
        //                     break;
        //                 case 'u':
        //                     e.preventDefault();
        //                     document.execCommand('underline');
        //                     break;
        //                 case 's':
        //                     e.preventDefault();
        //                     saveToLocalStorage();
        //                     alert('Content saved!');
        //                     break;
        //             }
        //         }
        //     });
        // }
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key.toLowerCase()) {
                        case 'b':
                            e.preventDefault();
                            document.execCommand('bold');
                            setTimeout(() => {
                                const focusedElement = document.activeElement;
                                const focusedHeading = focusedElement.closest('.card-heading');
                                const focusedContent = focusedElement.closest('.card-content');
                                
                                if (focusedHeading || focusedContent) {
                                    const cardIndex = focusedElement.closest('.card')?.dataset.index;
                                    if (cardIndex !== undefined) {
                                        if (focusedHeading) {
                                            cards[cardIndex].heading = focusedHeading.innerHTML;
                                        }
                                        if (focusedContent) {
                                            cards[cardIndex].content = focusedContent.innerHTML;
                                        }
                                        saveToJSON();
                                    }
                                }
                            }, 0);
                            break;
                        case 'i':
                            e.preventDefault();
                            document.execCommand('italic');
                            setTimeout(() => {
                                const focusedElement = document.activeElement;
                                const focusedHeading = focusedElement.closest('.card-heading');
                                const focusedContent = focusedElement.closest('.card-content');
                                
                                if (focusedHeading || focusedContent) {
                                    const cardIndex = focusedElement.closest('.card')?.dataset.index;
                                    if (cardIndex !== undefined) {
                                        if (focusedHeading) {
                                            cards[cardIndex].heading = focusedHeading.innerHTML;
                                        }
                                        if (focusedContent) {
                                            cards[cardIndex].content = focusedContent.innerHTML;
                                        }
                                        saveToJSON();
                                    }
                                }
                            }, 0);
                            break;
                        case 'u':
                            e.preventDefault();
                            document.execCommand('underline');
                            setTimeout(() => {
                                const focusedElement = document.activeElement;
                                const focusedHeading = focusedElement.closest('.card-heading');
                                const focusedContent = focusedElement.closest('.card-content');
                                
                                if (focusedHeading || focusedContent) {
                                    const cardIndex = focusedElement.closest('.card')?.dataset.index;
                                    if (cardIndex !== undefined) {
                                        if (focusedHeading) {
                                            cards[cardIndex].heading = focusedHeading.innerHTML;
                                        }
                                        if (focusedContent) {
                                            cards[cardIndex].content = focusedContent.innerHTML;
                                        }
                                        saveToJSON();
                                    }
                                }
                            }, 0);
                            break;
                    }
                }
            });
        }
        // Preview Mode
        function togglePreview() {
            isPreviewMode = !isPreviewMode;
            document.body.classList.toggle('preview-mode');
            const btn = document.getElementById('previewBtn');
            // btn.textContent = isPreviewMode ? '‚úèÔ∏è Edit' : 'üëÅÔ∏è Preview';
            btn.textContent = isPreviewMode ? (currentLanguage === 'fa' ? 'Ÿà€åÿ±ÿß€åÿ¥' : 'Edit') : (currentLanguage === 'fa' ? 'Ÿæ€åÿ¥‚ÄåŸÜŸÖÿß€åÿ¥' : 'Preview');
            
            const authorInfo = document.getElementById('authorInfo');
            const recentPosts = document.getElementById('recentPosts');
            
            if (isPreviewMode) {
                // authorInfo.style.display = 'flex';
                // recentPosts.style.display = 'block';
                
                // Apply visibility settings
                if (!showAuthorInfo) {
                    authorInfo.classList.add('hidden');
                    authorInfo.style.display = 'none';
                }
                if (!showRecentPosts) {
                    recentPosts.classList.add('hidden');
                    recentPosts.style.display = 'none';
                }
            } else {
                authorInfo.style.display = 'flex';
                recentPosts.style.display = 'block';
                // authorInfo.style.display = 'none';
                // recentPosts.style.display = 'none';
                authorInfo.classList.remove('hidden');
                recentPosts.classList.remove('hidden');
            }
            
            renderCards();
        }

        // Export Functions
        function exportContent() {
            const format = document.getElementById('exportFormat').value;
            let content, filename, type;

            switch(format) {
                case 'json':
                    content = JSON.stringify(cards.map(card => ({
                        heading: card.heading,
                        content: card.content,
                        image: card.image,
                        imagePosition: card.imagePosition,
                        imageWidth: card.imageWidth,
                        imageHeight: card.imageHeight
                    })), null, 2);
                    filename = 'blog-content.json';
                    type = 'application/json';
                    break;
                
                case 'html':
                    content = generateHTML();
                    filename = 'blog-content.html';
                    type = 'text/html';
                    break;
                
                case 'markdown':
                    content = generateMarkdown();
                    filename = 'blog-content.md';
                    type = 'text/markdown';
                    break;
            }

            downloadFile(content, filename, type);
            document.getElementById('exportModal').classList.remove('active');
        }

        function generateHTML() {
            let html = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Content</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; max-width: 1100px; margin: 0 auto; padding: 2rem; background: #f8f9fa; }
        .card { background: white; border-radius: 16px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 4px 16px rgba(0,0,0,0.08); }
        h1 { font-size: 1.75rem; margin-bottom: 1rem; }
        img { max-width: 100%; border-radius: 12px; }
    </style>
</head>
<body>
`;
            
            cards.forEach(card => {
                html += `    <div class="card">
        <h1>${card.heading}</h1>
        ${card.image ? `<img src="${card.image}" alt="${card.heading}">` : ''}
        <div>${card.content}</div>
    </div>
`;
            });
            
            html += `</body>
</html>`;
            return html;
        }

        function generateMarkdown() {
            let markdown = '';
            
            cards.forEach(card => {
                markdown += `# ${card.heading}\n\n`;
                if (card.image) {
                    markdown += `![${card.heading}](${card.image})\n\n`;
                }
                markdown += `${card.content}\n\n---\n\n`;
            });
            
            return markdown;
        }

        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Load JSON Data
        function loadJsonData() {
            const jsonInput = document.getElementById('jsonInput').value;
            try {
                const data = JSON.parse(jsonInput);
                if (Array.isArray(data)) {
                    cards = data.map(item => createCard(item));
                    renderCards();
                    saveToLocalStorage();
                    document.getElementById('loadJsonModal').classList.remove('active');
                    document.getElementById('jsonInput').value = '';
                } else {
                    alert('Please provide a valid JSON array');
                }
            } catch (error) {
                alert('Invalid JSON format: ' + error.message);
            }
        }

        // Publish Blog
        async function publishBlog() {
            console.log('Publishing blog data:');
            saveToJSON()
            const blogTitle = params.get('title');
            response = await authFetch(`/blogs/${blogTitle}/publish/` ,{
                    method: 'GET',
                });
            // // Download JSON for testing
            // downloadFile(JSON.stringify(blogData, null, 2), 'blog-publish.json', 'application/json');
            
            window.location.href = `admin.html`;
        }

        // Section visibility toggles
        function toggleSectionMenu(section) {
            const menuId = section === 'author' ? 'authorMenu' : 'recentMenu';
            const menu = document.getElementById(menuId);
            const allMenus = document.querySelectorAll('.section-menu');
            
            allMenus.forEach(m => {
                if (m !== menu) m.classList.remove('active');
            });
            
            menu.classList.toggle('active');
        }

        function toggleAuthorVisibility() {
            showAuthorInfo = document.getElementById('showAuthorInfo').checked;
            localStorage.setItem('showAuthorInfo', showAuthorInfo);
            
            const authorInfo = document.getElementById('authorInfo');
            if (isPreviewMode) {
                if (showAuthorInfo) {
                    authorInfo.classList.remove('hidden');
                } else {
                    authorInfo.classList.add('hidden');
                }
            }
        }

        function toggleRecentVisibility() {
            showRecentPosts = document.getElementById('showRecentPosts').checked;
            localStorage.setItem('showRecentPosts', showRecentPosts);
            
            const recentPosts = document.getElementById('recentPosts');
            if (isPreviewMode) {
                if (showRecentPosts) {
                    recentPosts.classList.remove('hidden');
                } else {
                    recentPosts.classList.add('hidden');
                }
            }
        }

        // Close section menus when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.section-toggle-menu')) {
                document.querySelectorAll('.section-menu').forEach(m => {
                    m.classList.remove('active');
                });
            }
        });

        // Local Storage
        function saveToLocalStorage() {
            localStorage.setItem('blogCards', JSON.stringify(cards));
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('blogCards');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    cards = data.map(item => createCard(item));
                } catch (error) {
                    console.error('Error loading from localStorage:', error);
                    cards = [];
                }
            }
        }
    </script>
</body>
</html>
